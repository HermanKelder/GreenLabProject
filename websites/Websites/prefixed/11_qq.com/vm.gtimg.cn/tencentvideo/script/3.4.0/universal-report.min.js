/**
 * UniversalReport
 * v3.4.0
 * @author jeffjnfeng 2022-01-20 14:59:07
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).UniversalReport=e()}(this,(function(){"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n,r=function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function o(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function i(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function a(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function s(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function u(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}!function(t){t.PGIN="dt_pgin",t.PGOUT="dt_pgout",t.IMP="dt_imp",t.IMPEND="dt_imp_end",t.CLCK="dt_clck"}(n||(n={}));var c,l,p={dt_qq_h5:"",dt_qqopenid_h5:"",dt_wxopenid_h5:"",dt_wbopenid_h5:"",dt_mainlogin_h5:""};!function(t){t.ENABLE_FEATURE="1"}(c||(c={})),function(t){t.REPORT_VIEW="reportView",t.REALTIME_DEBUG="realTimeDebug",t.REPORT_VIEW_SET_TOKEN="setToken",t.REPORT_VIEW_PLUGIN_TOKEN="pluginToken"}(l||(l={}));var d="function",h="object",f="model",v="name",g="type",m="vendor",y="version",b="console",w="phone",_="tablet",P="tv",k={has:function(t,e){return"string"==typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()}},E={rgx:function(t,e){for(var n,r,o,i,a,s,u=0;u<e.length&&!a;){var c=e[u],l=e[u+1];for(n=r=0;n<c.length&&!a;)if(a=c[n++].exec(t))for(o=0;o<l.length;o++)s=a[++r],typeof(i=l[o])===h&&i.length>0?2==i.length?typeof i[1]==d?this[i[0]]=i[1].call(this,s):this[i[0]]=i[1]:3==i.length?typeof i[1]!==d||i[1].exec&&i[1].test?this[i[0]]=s?s.replace(i[1],i[2]):void 0:this[i[0]]=s?i[1].call(this,s,i[2]):void 0:4==i.length&&(this[i[0]]=s?i[3].call(this,s.replace(i[1],i[2])):void 0):this[i]=s||void 0;u+=2}},str:function(t,e){for(var n in e)if(typeof e[n]===h&&e[n].length>0){for(var r=0;r<e[n].length;r++)if(k.has(e[n][r],t))return"?"===n?void 0:n}else if(k.has(e[n],t))return"?"===n?void 0:n;return t}},O={os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},S={device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[f,m,[g,_]],[/applecoremedia\/[\w\.]+ \((ipad)/],[f,[m,"Apple"],[g,_]],[/(apple\s{0,1}tv)/i],[[f,"Apple TV"],[m,"Apple"],[g,P]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[m,f,[g,_]],[/(kf[A-z]+)(\sbuild\/|\)).+silk\//i],[f,[m,"Amazon"],[g,_]],[/android.+aft([bms])\sbuild/i],[f,[m,"Amazon"],[g,P]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[f,m,[g,w]],[/\((ip[honed|\s\w*]+);/i],[f,[m,"Apple"],[g,w]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[m,f,[g,w]],[/\(bb10;\s(\w+)/i],[f,[m,"BlackBerry"],[g,w]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[f,[m,"Asus"],[g,_]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[m,"Sony"],[f,"Xperia Tablet"],[g,_]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[m,"Sony"],[g,w]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[m,f,[g,b]],[/android.+;\s(shield)\sbuild/i],[f,[m,"Nvidia"],[g,b]],[/(playstation\s[34portablevi]+)/i],[f,[m,"Sony"],[g,b]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[m,[f,/_/g," "],[g,w]],[/(nexus\s9)/i],[f,[m,"HTC"],[g,_]],[/d\/huawei([\w\s-]+)[;\)]/i,/android.+\s(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?)/i],[f,[m,"Huawei"],[g,w]],[/android.+(bah2?-a?[lw]\d{2})/i],[f,[m,"Huawei"],[g,_]],[/(microsoft);\s(lumia[\s\w]+)/i],[m,f,[g,w]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[f,[m,"Microsoft"],[g,b]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[m,"Microsoft"],[g,w]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[f,[m,"Motorola"],[g,_]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[m,"Samsung"],[g,P]],[/\(dtv[\);].+(aquos)/i],[f,[m,"Sharp"],[g,P]],[/android.+((sch-i[89]0\d|shw-m380s|SM-P605|SM-P610|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[m,"Samsung"],f,[g,_]],[/smart-tv.+(samsung)/i],[m,[g,P],f],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[m,"Samsung"],f,[g,w]],[/sie-(\w*)/i],[f,[m,"Siemens"],[g,w]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[m,"Nokia"],f,[g,w]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[f,[m,"Acer"],[g,_]],[/android.+([vl]k\-?\d{3})\s+build/i],[f,[m,"LG"],[g,_]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[m,"LG"],f,[g,_]],[/linux;\snetcast.+smarttv/i,/lg\snetcast\.tv-201\d/i],[[m,"LG"],f,[g,P]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[f,[m,"LG"],[g,w]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[m,f,[g,_]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[f,[m,"Lenovo"],[g,_]],[/(lenovo)[_\s-]?([\w-]+)/i],[m,f,[g,w]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[m,f,[g,w]],[/(HM\sNOTE)/i,/(HM\s\w+)/i,/(MI\s\w+)/i,/(MI-ONE\sPlus)/i,/(M1)\sBuild/i,/(HM\d+)/i,/Xiaomi[\s_]?([\w_]+)/i],[[f,/_/g," "],[m,"Xiaomi"],[g,w]],[/android.+(mi[\s\-_]?(?:pad)(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i],[[f,/_/g," "],[m,"Xiaomi"],[g,_]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[f,[m,"Meizu"],[g,w]],[/(mz)-([\w-]{2,})/i],[[m,"Meizu"],f,[g,w]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[f,[m,"OnePlus"],[g,w]],[/android .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[f,[g,w]],[/android .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[f,[g,_]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[g,k.lowerize],m,f],[/[\s\/\(](smart-?tv)[;\)]/i],[[g,P]],[/(android[\w\.\s\-]{0,9});.+build/i],[f,[m,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[y,[v,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[v,y],[/rv\:([\w\.]{1,9}).+(gecko)/i],[y,v]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[v,y],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[v,[y,E.str,O.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[v,"windows"],[y,E.str,O.os.windows.version]],[/(android)[\/\s-]?([\w\.]*)/i],[v,y],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[y,/_/g,"."],[v,"ios"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[v,"macos"],[y,/_/g,"."]]]},R=function(){function t(t,e){var n,r;this.ua=t||(null!==(r=null===(n=null===window||void 0===window?void 0:window.navigator)||void 0===n?void 0:n.userAgent)&&void 0!==r?r:""),this.rgxmap=S}return t.prototype.getDevice=function(){var t={vendor:void 0,model:void 0,type:void 0};return E.rgx.call(t,this.ua,this.rgxmap.device),t},t.prototype.getEngine=function(){var t={name:void 0,version:void 0};return E.rgx.call(t,this.ua,this.rgxmap.engine),t},t.prototype.getOS=function(){var t={name:void 0,version:void 0};return E.rgx.call(t,this.ua,this.rgxmap.os),t},t.prototype.getResult=function(){return{engine:this.getEngine(),os:this.getOS(),device:this.getDevice()}},t}(),I=function(t){var e=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},T=function(t,e){return Object.keys(t).filter((function(t){return!e.includes(t)})).map((function(e){var n;return e in t?((n={})[e]=t[e],n):{}})).reduce((function(t,e){return Object.assign(t,e)}),{})},x=function(t){var e,n=t;return"string"==typeof n&&(n=document.querySelector(n)),e=n,("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName)?n:null},C=function(){if(!document.body)return 0;var t=document.createElement("div");t.style.height="1in",t.style.width="1in",t.style.top="-100%",t.style.left="-100%",t.style.position="absolute",document.body.appendChild(t);var e=t.offsetHeight;return document.body.removeChild(t),e},A=function(t){var e;if("string"==typeof t||"object"==typeof t&&(null===(e=t.baseInfo)||void 0===e?void 0:e.appkey)&&t.onUserAction&&t.onDirectUserAction)return!0},N=function(t,e){var o,i;return void 0===e&&(e="udf_kv"),[n.PGIN,n.PGOUT].includes(t.eventName)?r(r({},t.publicParams),((o={})[e]=JSON.stringify(r({},t.pageParams)),o)):r(r({},t.publicParams),((i={})[e]=JSON.stringify(r({cur_pg:r({},t.pageParams)},t.businessParams)),i))},j=function(t,e,n){var o;void 0===e&&(e=1),void 0===n&&(n={});for(var i=n.eid?[n.eid]:[],a=n.eid?[n]:[],s=n,u=t;u;){var c=null===(o=u.data)||void 0===o?void 0:o.eid;c&&(e?s=r(r({eid:c},u.data.params),s):(i.push(c),a.push(r({eid:c},u.data.params)))),u=u.parent}return e?s:{element_path:i,element_params:a}},D=function(t){return t&&"[object Object]"===Object.prototype.toString.call(t)?Object.entries(t).reduce((function(t,e){var n,r=e[0].substring(3);return Object.assign(t,((n={})[r]=e[1],n))}),{}):{}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function M(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function L(t,e){return t(e={exports:{}},e.exports),e.exports}var U=L((function(t,e){t.exports=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)},e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function n(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function r(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var o="__BEACON_",i="__BEACON_deviceId",a="last_report_time",s="sending_event_ids",u="beacon_config",c="beacon_config_request_time",l=function(){function t(){var t=this;this.emit=function(e,n){if(t){var r,o=t.__EventsList[e];if(null==o?void 0:o.length){o=o.slice();for(var i=0;i<o.length;i++){r=o[i];try{var a=r.callback.apply(t,[n]);if(1===r.type&&t.remove(e,r.callback),!1===a)break}catch(t){throw t}}}return t}},this.__EventsList={}}return t.prototype.indexOf=function(t,e){for(var n=0;n<t.length;n++)if(t[n].callback===e)return n;return-1},t.prototype.on=function(t,e,n){if(void 0===n&&(n=0),this){var r=this.__EventsList[t];if(r||(r=this.__EventsList[t]=[]),-1===this.indexOf(r,e)){var o={name:t,type:n||0,callback:e};return r.push(o),this}return this}},t.prototype.one=function(t,e){this.on(t,e,1)},t.prototype.remove=function(t,e){if(this){var n=this.__EventsList[t];if(!n)return null;if(!e){try{delete this.__EventsList[t]}catch(t){}return null}if(n.length){var r=this.indexOf(n,e);n.splice(r,1)}return this}},t}();function p(t,e){for(var n={},r=0,o=Object.keys(t);r<o.length;r++){var i=o[r],a=t[i];if("string"==typeof a)n[d(i)]=d(a);else{if(e)throw new Error("value mast be string  !!!!");n[d(String(i))]=d(String(a))}}return n}function d(t){if("string"!=typeof t)return t;try{return t.replace(new RegExp("\\|","g"),"%7C").replace(new RegExp("\\&","g"),"%26").replace(new RegExp("\\=","g"),"%3D").replace(new RegExp("\\+","g"),"%2B")}catch(t){return""}}function h(t){return String(t.A99)+String(t.A100)}var f=function(){},v=function(){function t(t){var n=this;this.lifeCycle=new l,this.uploadJobQueue=[],this.additionalParams={},this.delayTime=0,this._normalLogPipeline=function(t){if(!t||!t.reduce||!t.length)throw new TypeError("createPipeline 方法需要传入至少有一个 pipe 的数组");return 1===t.length?function(e,n){t[0](e,n||f)}:t.reduce((function(t,e){return function(n,r){return void 0===r&&(r=f),t(n,(function(t){return null==e?void 0:e(t,r)}))}}))}([function(t){n.send({url:n.strategy.getUploadUrl(),data:t,method:"post",contentType:"application/json;charset=UTF-8"},(function(){var e=n.config.onReportSuccess;"function"==typeof e&&e(JSON.stringify(t.events))}),(function(){var e=n.config.onReportFail;"function"==typeof e&&e(JSON.stringify(t.events))}))}]),function(t,e){if(!t)throw e instanceof Error?e:new Error(e)}(Boolean(t.appkey),"appkey must be initial"),this.config=e({},t)}return t.prototype.onUserAction=function(t,e){this.preReport(t,e,!1)},t.prototype.onDirectUserAction=function(t,e){this.preReport(t,e,!0)},t.prototype.preReport=function(t,e,n){t?this.strategy.isEventUpOnOff()&&(this.strategy.isBlackEvent(t)||this.strategy.isSampleEvent(t)||this.onReport(t,e,n)):this.errorReport.reportError("602"," no eventCode")},t.prototype.addAdditionalParams=function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var r=n[e];this.additionalParams[r]=t[r]}},t.prototype.setChannelId=function(t){this.commonInfo.channelID=String(t)},t.prototype.setOpenId=function(t){this.commonInfo.openid=String(t)},t.prototype.setUnionid=function(t){this.commonInfo.unid=String(t)},t.prototype.getDeviceId=function(){return this.commonInfo.deviceId},t.prototype.getCommonInfo=function(){return this.commonInfo},t.prototype.removeSendingId=function(t){try{var e=JSON.parse(this.storage.getItem(s)),n=e.indexOf(t);-1!=n&&(e.splice(n,1),this.storage.setItem(s,JSON.stringify(e)))}catch(t){}},t}(),g=function(){function t(t,e,n,r){this.requestParams={},this.network=r,this.requestParams.attaid="00400014144",this.requestParams.token="6478159937",this.requestParams.product_id=t.appkey,this.requestParams.platform=n,this.requestParams.uin=e.deviceId,this.requestParams.model="",this.requestParams.os=n,this.requestParams.app_version=t.appVersion,this.requestParams.sdk_version=e.sdkVersion,this.requestParams.error_stack="",this.uploadUrl=t.isOversea?"https://htrace.wetvinfo.com/kv":"https://h.trace.qq.com/kv"}return t.prototype.reportError=function(t,e){this.requestParams._dc=Math.random(),this.requestParams.error_msg=e,this.requestParams.error_code=t,this.network.get(this.uploadUrl,{params:this.requestParams}).catch((function(t){}))},t}(),m=function(){function t(t,e,n,r){this.strategy={isEventUpOnOff:!0,httpsUploadUrl:"https://otheve.beacon.qq.com/analytics/v2_upload",requestInterval:30,blacklist:[],samplelist:[]},this.realSample={},this.appkey="",this.appkey=t.appkey,this.storage=n;try{var o=JSON.parse(this.storage.getItem(u));o&&this.processData(o)}catch(t){}t.isOversea&&(this.strategy.httpsUploadUrl="https://svibeacon.onezapp.com/analytics/v2_upload"),!t.isOversea&&this.needRequestConfig()&&this.requestConfig(t.appVersion,e,r)}return t.prototype.requestConfig=function(t,e,n){var r=this;this.storage.setItem(c,Date.now().toString()),n.post("https://oth.str.beacon.qq.com/trpc.beacon.configserver.BeaconConfigService/QueryConfig",{platformId:"undefined"==typeof wx?"3":"4",mainAppKey:this.appkey,appVersion:t,sdkVersion:e.sdkVersion,osVersion:e.userAgent,model:"",packageName:"",params:{A3:e.deviceId}}).then((function(t){if(0==t.data.ret)try{var e=JSON.parse(t.data.beaconConfig);e&&(r.processData(e),r.storage.setItem(u,t.data.beaconConfig))}catch(t){}else r.processData(null),r.storage.setItem(u,"")})).catch((function(t){}))},t.prototype.processData=function(t){var e,n,r,o,i;this.strategy.isEventUpOnOff=null!==(e=null==t?void 0:t.isEventUpOnOff)&&void 0!==e?e:this.strategy.isEventUpOnOff,this.strategy.httpsUploadUrl=null!==(n=null==t?void 0:t.httpsUploadUrl)&&void 0!==n?n:this.strategy.httpsUploadUrl,this.strategy.requestInterval=null!==(r=null==t?void 0:t.requestInterval)&&void 0!==r?r:this.strategy.requestInterval,this.strategy.blacklist=null!==(o=null==t?void 0:t.blacklist)&&void 0!==o?o:this.strategy.blacklist,this.strategy.samplelist=null!==(i=null==t?void 0:t.samplelist)&&void 0!==i?i:this.strategy.samplelist;for(var a=0,s=this.strategy.samplelist;a<s.length;a++){var u=s[a].split(",");2==u.length&&(this.realSample[u[0]]=u[1])}},t.prototype.needRequestConfig=function(){var t=Number(this.storage.getItem(c));return Date.now()-t>60*this.strategy.requestInterval*1e3},t.prototype.getUploadUrl=function(){return this.strategy.httpsUploadUrl+"?appkey="+this.appkey},t.prototype.isBlackEvent=function(t){return-1!=this.strategy.blacklist.indexOf(t)},t.prototype.isEventUpOnOff=function(){return this.strategy.isEventUpOnOff},t.prototype.isSampleEvent=function(t){return!!Object.prototype.hasOwnProperty.call(this.realSample,t)&&this.realSample[t]<Math.floor(Math.random()*Math.floor(1e4))},t}(),y="session_storage_key",b=function(){function t(t,e,n){this.beacon=n,this.storage=t,this.duration=e,this.appkey=n.config.appkey}return t.prototype.getSession=function(){var t=this.storage.getItem(y);if(!t)return this.createSession();var e="",n=0;try{var r=JSON.parse(t)||{sessionId:void 0,sessionStart:void 0};if(!r.sessionId||!r.sessionStart)return this.createSession();var o=Number(this.storage.getItem(a));if(Date.now()-o>this.duration)return this.createSession();e=r.sessionId,n=r.sessionStart}catch(t){}return{sessionId:e,sessionStart:n}},t.prototype.createSession=function(){var t=Date.now(),e={sessionId:this.appkey+"_"+t.toString(),sessionStart:t};this.storage.setItem(y,JSON.stringify(e)),this.storage.setItem(a,t.toString());var n="is_new_user",r=this.storage.getItem(n);return this.beacon.onDirectUserAction("rqd_applaunched",{A21:r?"N":"Y"}),this.storage.setItem(n,JSON.stringify(!1)),e},t}();function w(){var t=navigator.userAgent,e=t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1,n=t.indexOf("Edge")>-1&&!e,r=t.indexOf("Trident")>-1&&t.indexOf("rv:11.0")>-1;if(e){new RegExp("MSIE (\\d+\\.\\d+);").test(t);var o=parseFloat(RegExp.$1);return 7==o?7:8==o?8:9==o?9:10==o?10:6}return n?-2:r?11:-1}var _,P=function(){return(P=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},k=function(){function t(t,e){void 0===e&&(e={}),this.reportOptions={},this.config=t,this.reportOptions=e}return t.canUseDB=function(){return!!(null===window||void 0===window?void 0:window.indexedDB)},t.prototype.openDB=function(){var e=this;return new Promise((function(n,r){if(!t.canUseDB())return r({message:"当前不支持 indexeddb"});var o=e.config,i=o.name,a=o.version,s=o.stores,u=indexedDB.open(i,a);u.onsuccess=function(){e.db=u.result,n(),P({result:1,func:"open",params:JSON.stringify(e.config)},e.reportOptions)},u.onerror=function(t){var n,o;r(t),P({result:0,func:"open",params:JSON.stringify(e.config),error_msg:null===(o=null===(n=t.target)||void 0===n?void 0:n.error)||void 0===o?void 0:o.message},e.reportOptions)},u.onupgradeneeded=function(){e.db=u.result;try{null==s||s.forEach((function(t){e.createStore(t)}))}catch(t){P({result:0,func:"open",params:JSON.stringify(e.config),error_msg:t.message},e.reportOptions),r(t)}}}))},t.prototype.useStore=function(t){return this.storeName=t,this},t.prototype.deleteDB=function(){var t=this;return this.closeDB(),new Promise((function(e,n){var r=indexedDB.deleteDatabase(t.config.name);r.onsuccess=function(){return e()},r.onerror=n}))},t.prototype.closeDB=function(){var t;null===(t=this.db)||void 0===t||t.close(),this.db=null},t.prototype.getStoreCount=function(){var t=this;return new Promise((function(e,n){var r=t.getStore("readonly").count();r.onsuccess=function(){return e(r.result)},r.onerror=n}))},t.prototype.clearStore=function(){var t=this;return new Promise((function(e,n){var r=t.getStore("readwrite").clear();r.onsuccess=function(){return e()},r.onerror=n}))},t.prototype.add=function(t,e){var n=this;return new Promise((function(r,o){var i=n.getStore("readwrite").add(t,e);i.onsuccess=function(){r(i.result)},i.onerror=o}))},t.prototype.put=function(t,e){var n=this;return new Promise((function(r,o){var i=n.getStore("readwrite").put(t,e);i.onsuccess=function(){r(i.result)},i.onerror=o}))},t.prototype.getStoreAllData=function(){var t=this;return new Promise((function(e,n){var r=t.getStore("readonly").openCursor(),o=[];r.onsuccess=function(){var t;if(null===(t=r.result)||void 0===t?void 0:t.value){var n=r.result.value;o.push(n),r.result.continue()}else e(o)},r.onerror=n}))},t.prototype.getDataRangeByIndex=function(t,e,n,r,o){var i=this;return new Promise((function(a,s){var u=i.getStore().index(t),c=IDBKeyRange.bound(e,n,r,o),l=[],p=u.openCursor(c);p.onsuccess=function(){var t;(null===(t=null==p?void 0:p.result)||void 0===t?void 0:t.value)?(l.push(null==p?void 0:p.result.value),null==p||p.result.continue()):a(l)},p.onerror=s}))},t.prototype.removeDataByIndex=function(t,e,n,r,o){var i=this;return new Promise((function(a,s){var u=i.getStore("readwrite").index(t),c=IDBKeyRange.bound(e,n,r,o),l=u.openCursor(c),p=0;l.onsuccess=function(t){var e=t.target.result;e?(p+=1,e.delete(),e.continue()):a(p)},l.onerror=s}))},t.prototype.createStore=function(t){var e=t.name,n=t.indexes,r=void 0===n?[]:n,o=t.options;if(this.db){this.db.objectStoreNames.contains(e)&&this.db.deleteObjectStore(e);var i=this.db.createObjectStore(e,o);r.forEach((function(t){i.createIndex(t.indexName,t.keyPath,t.options)}))}},t.prototype.getStore=function(t){var e;return void 0===t&&(t="readonly"),null===(e=this.db)||void 0===e?void 0:e.transaction(this.storeName,t).objectStore(this.storeName)},t}(),E="event_table_v3",O="eventId",S=function(){function t(t){this.isReady=!1,this.taskQueue=Promise.resolve(),this.db=new k({name:"Beacon_"+t+"_V3",version:1,stores:[{name:E,options:{keyPath:O},indexes:[{indexName:O,keyPath:O,options:{unique:!0}}]}]}),this.open()}return t.prototype.getCount=function(){var t=this;return this.readyExec((function(){return t.db.getStoreCount()}))},t.prototype.setItem=function(t,e){var n=this;return this.readyExec((function(){return n.db.add({eventId:t,value:e})}))},t.prototype.getItem=function(t){return n(this,void 0,void 0,(function(){var e=this;return r(this,(function(n){return[2,this.readyExec((function(){return e.db.getDataRangeByIndex(O,t,t)}))]}))}))},t.prototype.removeItem=function(t){var e=this;return this.readyExec((function(){return e.db.removeDataByIndex(O,t,t)}))},t.prototype.updateItem=function(t,e){var n=this;return this.readyExec((function(){return n.db.put({eventId:t,value:e})}))},t.prototype.iterate=function(t){var e=this;return this.readyExec((function(){return e.db.getStoreAllData().then((function(e){e.forEach((function(e){t(e.value)}))}))}))},t.prototype.open=function(){return n(this,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return this.taskQueue=this.taskQueue.then((function(){return t.db.openDB()})),[4,this.taskQueue];case 1:return e.sent(),this.isReady=!0,this.db.useStore(E),[2]}}))}))},t.prototype.readyExec=function(t){return this.isReady?t():(this.taskQueue=this.taskQueue.then((function(){return t()})),this.taskQueue)},t}(),R=function(){function t(t){this.keyObject={},this.storage=t}return t.prototype.getCount=function(){return this.storage.getStoreCount()},t.prototype.removeItem=function(t){this.storage.removeItem(t),delete this.keyObject[t]},t.prototype.setItem=function(t,e){var n=JSON.stringify(e);this.storage.setItem(t,n),this.keyObject[t]=e},t.prototype.iterate=function(t){for(var e=Object.keys(this.keyObject),n=0;n<e.length;n++){var r=this.storage.getItem(e[n]);t(JSON.parse(r))}},t}(),I=function(){function t(t,e){var n=this;this.dbEventCount=0,w()>0||!window.indexedDB||/X5Lite/.test(navigator.userAgent)?(this.store=new R(e),this.dbEventCount=this.store.getCount()):(this.store=new S(t),this.getCount().then((function(t){n.dbEventCount=t})))}return t.prototype.getCount=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.store.getCount()];case 1:return[2,t.sent()];case 2:return t.sent(),[2,Promise.reject()];case 3:return[2]}}))}))},t.prototype.insertEvent=function(t,e){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:if(this.dbEventCount>=1e4)return[2,Promise.reject()];n=h(t.mapValue),r.label=1;case 1:return r.trys.push([1,3,,4]),this.dbEventCount++,[4,this.store.setItem(n,t)];case 2:return[2,r.sent()];case 3:return o=r.sent(),e&&e(o,t),this.dbEventCount--,[2,Promise.reject()];case 4:return[2]}}))}))},t.prototype.getEvents=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:t=[],e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.store.iterate((function(e){t.push(e)}))];case 2:case 3:return e.sent(),[2,Promise.all(t)];case 4:return[2]}}))}))},t.prototype.removeEvent=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:e=h(t.mapValue),n.label=1;case 1:return n.trys.push([1,3,,4]),this.dbEventCount--,[4,this.store.removeItem(e)];case 2:return[2,n.sent()];case 3:return n.sent(),this.dbEventCount++,[2,Promise.reject()];case 4:return[2]}}))}))},t}(),T=function(){return(T=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function x(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}function C(t,e){var n=[null,void 0,"",NaN].includes(t);if(e.isSkipEmpty&&n)return null;var r=!e.isSkipEmpty&&n?"":t;try{return e.encode?encodeURIComponent(r):r}catch(t){return null}}function A(t){var e=t.split("#"),n=e[0],r=e[1],o=void 0===r?"":r,i=n.split("?"),a=i[0],s=i[1],u=void 0===s?"":s,c=x(o),l=Object.create(null);return u.split("&").forEach((function(t){var e=t.split("="),n=e[0],r=e[1],o=void 0===r?"":r,i=x(n),a=x(o);null===i||null===a||""===i&&""===a||l[i]||(l[i]=a)})),{url:a,query:l,hash:c}}function N(t,e){void 0===e&&(e={encode:!0,isSkipEmpty:!1});var n=t.url,r=t.query,o=void 0===r?{}:r,i=t.hash,a=n.split("#"),s=a[0],u=a[1],c=void 0===u?"":u,l=s.split("?")[0],p=[],d=C(i||c,e),h=T(T({},A(n).query),o);return Object.keys(h).forEach((function(t){var n=C(t,e),r=C(h[t],e);null!==n&&null!==r&&p.push(n+"="+r)})),l+(p.length?"?"+p.join("&"):"")+(d?"#"+d:"")}function j(t,e){return new Promise((function(n,r){if(e&&document.querySelectorAll("script[data-tag="+e+"]").length)return n();var o=document.createElement("script"),i=T({type:"text/javascript",charset:"utf-8"},t);Object.keys(i).forEach((function(t){return function(t,e,n){if(t)return void 0===n?t.getAttribute(e):t.setAttribute(e,n)}(o,t,i[t])})),e&&(o.dataset.tag=e),o.onload=function(){return n()},o.onreadystatechange=function(){var t=o.readyState;["complete","loaded"].includes(t)&&(o.onreadystatechange=null,n())},o.onerror=r,document.body.appendChild(o)}))}!function(t){t[t.equal=0]="equal",t[t.low=-1]="low",t[t.high=1]="high"}(_||(_={}));var D=function(){return(D=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function M(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function L(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var U=function(){function t(){this.interceptors=[]}return t.prototype.use=function(t,e){return this.interceptors.push({resolved:t,rejected:e}),this.interceptors.length-1},t.prototype.traverse=function(t,e){void 0===e&&(e=!1);var n=Promise.resolve(t);return(e?Array.prototype.reduceRight:Array.prototype.reduce).call(this.interceptors,(function(t,e){if(e){var r=e.resolved,o=e.rejected;n=n.then(r,o)}return t}),""),n},t.prototype.eject=function(t){this.interceptors[t]&&(this.interceptors[t]=null)},t}(),q={defaults:{timeout:0,method:"GET",mode:"cors",redirect:"follow",credentials:"same-origin"},headers:{common:{Accept:"application/json, text/plain, */*"},POST:{"Content-Type":"application/x-www-form-urlencoded"},PUT:{"Content-Type":"application/x-www-form-urlencoded"},PATCH:{"Content-Type":"application/x-www-form-urlencoded"}},baseURL:"",polyfillUrl:"https://vm.gtimg.cn/comps/script/fetch.min.js",interceptors:{request:new U,response:new U}},B=/^([a-z][a-z\d+\-.]*:)?\/\//i,V=Object.prototype.toString;function H(t){return M(this,void 0,void 0,(function(){var e;return L(this,(function(n){switch(n.label){case 0:if(window.fetch)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,j({src:t})];case 2:return n.sent(),[3,4];case 3:throw e=n.sent(),function(t){if("undefined"!=typeof Image){var e=new Image(1,1),n=D({attaid:"0f400053130",token:"6552374442",comps:"@tencent/ovb-request",version:"1.1.18",ua:navigator.userAgent,url:location.href,_dc:Math.random()},t),r=Object.keys(n).map((function(t){return t+"="+encodeURIComponent(n[t])})).join("&");e.src="https://h.trace.qq.com/kv?"+r}}({func:"loadPolyfill",result:0,params:t,error_msg:e.message}),new Error("加载 polyfill "+t+" 失败: "+e.message);case 4:return[2]}}))}))}function W(t){return["Accept","Content-Type"].forEach((function(e){return n=e,void((r=t.headers)&&Object.keys(r).forEach((function(t){t!==n&&t.toUpperCase()===n.toUpperCase()&&(r[n]=r[t],delete r[t])})));var n,r})),function(t){if("[object Object]"!==V.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}(t.body)&&(t.body=JSON.stringify(t.body),t.headers&&(t.headers["Content-Type"]="application/json;charset=utf-8")),t}function J(t){return M(this,void 0,void 0,(function(){var e,n,r,o,i,a,s,u,c,l,p,d,h,f,v,g,m;return L(this,(function(y){switch(y.label){case 0:return e=q.baseURL,n=q.defaults,r=q.interceptors,[4,H(q.polyfillUrl)];case 1:return y.sent(),(o=D(D({},n),t)).headers||(o.headers=function(t){void 0===t&&(t="GET");var e=q.headers[t]||{};return D(D({},q.headers.common),e)}(o.method)),W(o),[4,r.request.traverse(o,!0)];case 2:if((i=y.sent())instanceof Error)throw i;return i.url=function(t,e){return!t||B.test(e)?e:t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")}(e,i.url),a=i.url,s=i.timeout,u=i.params,c=i.method,l=["GET","DELETE","OPTIONS","HEAD"].includes(void 0===c?"GET":c)&&!!u,p=l?N({url:a,query:u}):a,d=[],s&&!i.signal&&(v=new Promise((function(t){h=setTimeout((function(){t(new Error("timeout"))}),s)})),d.push(v),f=new AbortController,i.signal=f.signal),d.push(fetch(p,i).catch((function(t){return t}))),[4,Promise.race(d)];case 3:return g=y.sent(),h&&clearTimeout(h),[4,r.response.traverse(g)];case 4:if((m=y.sent())instanceof Error)throw null==f||f.abort(),m;return[2,m]}}))}))}var F=function(){function t(t){q.interceptors.request.use((function(n){var r=n.url,o=n.method,i=n.body,a=i;if(t.onReportBeforeSend){var s=t.onReportBeforeSend({url:r,method:o,data:i});a=(null==s?void 0:s.data)||null}if("GET"!==o&&!a)throw new Error("No data for sdk, cancel.");return e(e({},n),{body:a})}))}return t.prototype.get=function(t,o){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return[4,J(e({url:t},o))];case 1:return[4,(n=r.sent()).json()];case 2:return i=r.sent(),[2,Promise.resolve({data:i,status:n.status,statusText:n.statusText,headers:n.headers})]}}))}))},t.prototype.post=function(t,o,i){return n(this,void 0,void 0,(function(){var n,a;return r(this,(function(r){switch(r.label){case 0:return[4,J(e({url:t,body:o,method:"POST"},i))];case 1:return[4,(n=r.sent()).json()];case 2:return a=r.sent(),[2,Promise.resolve({data:a,status:n.status,statusText:n.statusText,headers:n.headers})]}}))}))},t}(),G=function(){function t(t){this.appkey=t}return t.prototype.getItem=function(t){try{return window.localStorage.getItem(this.getStoreKey(t))}catch(t){return""}},t.prototype.removeItem=function(t){try{window.localStorage.removeItem(this.getStoreKey(t))}catch(t){}},t.prototype.setItem=function(t,e){try{window.localStorage.setItem(this.getStoreKey(t),e)}catch(t){}},t.prototype.setSessionItem=function(t,e){try{window.sessionStorage.setItem(this.getStoreKey(t),e)}catch(t){}},t.prototype.getSessionItem=function(t){try{return window.sessionStorage.getItem(this.getStoreKey(t))}catch(t){return""}},t.prototype.getStoreKey=function(t){return o+this.appkey+"_"+t},t.prototype.createDeviceId=function(){try{var t=window.localStorage.getItem(i);return t||(t=function(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz0123456789",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}(32),window.localStorage.setItem(i,t)),t}catch(t){return""}},t.prototype.clear=function(){try{for(var t=window.localStorage.length,e=0;e<t;e++){var n=window.localStorage.key(e);(null==n?void 0:n.substr(0,9))==o&&window.localStorage.removeItem(n)}}catch(t){}},t.prototype.getStoreCount=function(){var t=0;try{t=window.localStorage.length}catch(t){}return t},t}(),z=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t,e){t.exports=function(){function t(t,e,n,r,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var n,r=(function(t){t=function(t){var e,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(n){u=function(t,e,n){return t[e]=n}}function c(t,n,r,o){var i,a,s,u;return n=n&&n.prototype instanceof g?n:g,n=Object.create(n.prototype),o=new O(o||[]),n._invoke=(i=t,a=r,s=o,u=p,function(t,n){if(u===h)throw new Error("Generator is already running");if(u===f){if("throw"===t)throw n;return R()}for(s.method=t,s.arg=n;;){var r=s.delegate;if(r){var o=function t(n,r){var o;if((o=n.iterator[r.method])===e){if(r.delegate=null,"throw"===r.method){if(n.iterator.return&&(r.method="return",r.arg=e,t(n,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}return"throw"===(o=l(o,n.iterator,r.arg)).type?(r.method="throw",r.arg=o.arg,r.delegate=null,v):(o=o.arg)?o.done?(r[n.resultName]=o.value,r.next=n.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}(r,s);if(o){if(o===v)continue;return o}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(u===p)throw u=f,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);if(u=h,"normal"===(o=l(i,a,s)).type){if(u=s.done?f:d,o.arg!==v)return{value:o.arg,done:s.done}}else"throw"===o.type&&(u=f,s.method="throw",s.arg=o.arg)}}),n}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var p="suspendedStart",d="suspendedYield",h="executing",f="completed",v={};function g(){}function m(){}function y(){}var b={};b[i]=function(){return this},(o=(o=Object.getPrototypeOf)&&o(o(S([]))))&&o!==n&&r.call(o,i)&&(b=o);var w=y.prototype=g.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,s){if("throw"!==(o=l(t[o],t,i)).type){var u=o.arg;return(i=u.value)&&"object"==typeof i&&r.call(i,"__await")?e.resolve(i.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(i).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(o.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function S(t){if(t){if(n=t[i])return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n,o=-1;return(n=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n}).next=n}}return{next:R}}function R(){return{value:e,done:!0}}return((m.prototype=w.constructor=y).constructor=m).displayName=u(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){return!!(t="function"==typeof t&&t.constructor)&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,s,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},_(P.prototype),P.prototype[a]=function(){return this},t.AsyncIterator=P,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new P(c(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(w),u(w,s,"Generator"),w[i]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e,n=[];for(e in t)n.push(e);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=S,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;0<=i;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}var a=(i=i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc?null:i)?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r,o=n.completion;return"throw"===o.type&&(r=o.arg,E(n)),r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:S(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(n={exports:{}}),n.exports);return function(){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.version="1.0.0";var e=Array.prototype.map,r=Array.prototype.forEach;t&&(this.hasher=t),this.each=function(t,e,n){if(null!=t)if(r&&t.forEach===r)t.forEach(e,n);else if(t.length===+t.length){for(var o=0,i=t.length;o<i;o++)if(e.call(n,t[o],o,t)==={})return}else for(var a in t)if(t.hasOwnProperty(a)&&e.call(n,t[a],a,t)==={})return},this.map=function(t,n,r){var o=[];return null==t?o:e&&t.map===e?t.map(n,r):(this.each(t,(function(t,e,i){o[o.length]=n.call(r,t,e,i)})),o)}}var o,i,a,s;return o=n,(i=[{key:"getQimei36",value:function(t,e){var n=this;this.getHid().then((function(r){var o="3BJr"+t.substring(0,2)+(r&&r.substring(3,7)),i=new XMLHttpRequest;i.open("POST","https://snowflake.qq.com/ola/h5",!0),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE&&200==i.status)try{e&&e(JSON.parse(i.responseText))}catch(t){e(null)}},i.send(JSON.stringify({appKey:t,hid:r,sign:o,version:n.version}))}))}},{key:"getHid",value:(a=r.mark((function t(){var e,n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=[]).push((r=void 0,(r=[Math.floor(window.screen.width*window.devicePixelRatio),Math.floor(window.screen.height*window.devicePixelRatio)]).sort().reverse(),r.join("x"))),e.push((r=void 0,(r=[Math.floor(window.screen.availWidth*window.devicePixelRatio),Math.floor(window.screen.availHeight*window.devicePixelRatio)]).sort().reverse(),r.join("x"))),e.push(navigator.deviceMemory),e.push(!!window.sessionStorage),e.push(!!window.indexedDB),e.push(navigator.productSub),e.push(navigator.hardwareConcurrency),e.push(this.getWebglVendorAndRenderer()),e.push((new Date).getTimezoneOffset()),t.next=12,this.getFactor();case 12:if(n=t.sent,e.push(n),this.hasher)return t.abrupt("return",this.hasher(e.join("###"),31));t.next=18;break;case 18:return t.abrupt("return",this.x64hash128(e.join("###"),31));case 19:case"end":return t.stop()}var r}),t,this)})),s=function(){var e=this,n=arguments;return new Promise((function(r,o){var i=a.apply(e,n);function s(e){t(i,r,o,s,u,"next",e)}function u(e){t(i,r,o,s,u,"throw",e)}s(void 0)}))},function(){return s.apply(this,arguments)})},{key:"getUserAgent",value:function(){return navigator.userAgent}},{key:"getNative",value:function(){var t=this;this.getHid().then((function(e){JSInterface.callback(t.version,e,t.getUserAgent())}))}},{key:"getWebglVendorAndRenderer",value:function(){try{var t=function(){var t=document.createElement("canvas"),e=null;try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){}return e||null}(),e=t.getExtension("WEBGL_debug_renderer_info"),n=[t.getParameter(e.UNMASKED_VENDOR_WEBGL),t.getParameter(e.UNMASKED_RENDERER_WEBGL)].join("~"),r=t.getExtension("WEBGL_lose_context");return null!=r&&r.loseContext(),n}catch(t){return null}}},{key:"getFactor",value:function(){return new Promise((function(t,e){var n=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;n?function(){var e=new n({iceServers:[]});e.createDataChannel("",{reliable:!1}),e.onicecandidate=function(t){t.candidate&&i("a=".concat(t.candidate.candidate))},e.createOffer((function(t){i(t.sdp),e.setLocalDescription(t)}),(function(t){}));var r=Object.create(null);function o(e){if(!(e in r)){r[e]=!0;for(var n=Object.keys(r).filter((function(t){return r[t]})),o=0;o<n.length;o++)16<n[o].length&&(n.splice(o,1),o--);t(n[0])}}function i(t){(0<arguments.length&&void 0!==t?t:"").split("\r\n").forEach((function(t,e,n){var r,i;~t.indexOf("a=candidate")?(i=(r=t.split(" "))[4],"host"===r[7]&&o(i)):~t.indexOf("c=")&&o(t.split(" ")[2])}))}r["0.0.0.0"]=!1}():t(null)}))}},{key:"x64hash128",value:function(t,e){for(var n=function(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var n=[0,0,0,0];return n[3]+=t[3]+e[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=t[2]+e[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=t[1]+e[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=t[0]+e[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]},r=function(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var n=[0,0,0,0];return n[3]+=t[3]*e[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=t[2]*e[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=t[3]*e[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=t[1]*e[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=t[2]*e[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=t[3]*e[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=t[0]*e[3]+t[1]*e[2]+t[2]*e[1]+t[3]*e[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]},o=function(t,e){return 32==(e%=64)?[t[1],t[0]]:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e|t[0]>>>32-e]:[t[1]<<(e-=32)|t[0]>>>32-e,t[0]<<e|t[1]>>>32-e]},i=function(t,e){return 0==(e%=64)?t:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e]:[t[1]<<e-32,0]},a=function(t,e){return[t[0]^e[0],t[1]^e[1]]},s=function(t){return t=a(t,[0,t[0]>>>1]),t=r(t,[4283543511,3981806797]),t=a(t,[0,t[0]>>>1]),t=r(t,[3301882366,444984403]),a(t,[0,t[0]>>>1])},u=(t=t||"").length%16,c=t.length-u,l=[0,e=e||0],p=[0,e],d=[0,0],h=[0,0],f=[2277735313,289559509],v=[1291169091,658871167],g=0;g<c;g+=16)d=[255&t.charCodeAt(g+4)|(255&t.charCodeAt(g+5))<<8|(255&t.charCodeAt(g+6))<<16|(255&t.charCodeAt(g+7))<<24,255&t.charCodeAt(g)|(255&t.charCodeAt(g+1))<<8|(255&t.charCodeAt(g+2))<<16|(255&t.charCodeAt(g+3))<<24],h=[255&t.charCodeAt(g+12)|(255&t.charCodeAt(g+13))<<8|(255&t.charCodeAt(g+14))<<16|(255&t.charCodeAt(g+15))<<24,255&t.charCodeAt(g+8)|(255&t.charCodeAt(g+9))<<8|(255&t.charCodeAt(g+10))<<16|(255&t.charCodeAt(g+11))<<24],d=o(d=r(d,f),31),d=r(d,v),l=n(l=o(l=a(l,d),27),p),l=n(r(l,[0,5]),[0,1390208809]),h=o(h=r(h,v),33),h=r(h,f),p=n(p=o(p=a(p,h),31),l),p=n(r(p,[0,5]),[0,944331445]);switch(d=[0,0],h=[0,0],u){case 15:h=a(h,i([0,t.charCodeAt(g+14)],48));case 14:h=a(h,i([0,t.charCodeAt(g+13)],40));case 13:h=a(h,i([0,t.charCodeAt(g+12)],32));case 12:h=a(h,i([0,t.charCodeAt(g+11)],24));case 11:h=a(h,i([0,t.charCodeAt(g+10)],16));case 10:h=a(h,i([0,t.charCodeAt(g+9)],8));case 9:h=a(h,[0,t.charCodeAt(g+8)]),h=o(h=r(h,v),33),h=r(h,f),p=a(p,h);case 8:d=a(d,i([0,t.charCodeAt(g+7)],56));case 7:d=a(d,i([0,t.charCodeAt(g+6)],48));case 6:d=a(d,i([0,t.charCodeAt(g+5)],40));case 5:d=a(d,i([0,t.charCodeAt(g+4)],32));case 4:d=a(d,i([0,t.charCodeAt(g+3)],24));case 3:d=a(d,i([0,t.charCodeAt(g+2)],16));case 2:d=a(d,i([0,t.charCodeAt(g+1)],8));case 1:d=a(d,[t.charCodeAt(g)]),d=o(d=r(d,f),31),d=r(d,v),l=a(l,d)}return l=a(l,[0,t.length]),p=n(p=a(p,[0,t.length]),l=n(l,p)),l=s(l),p=n(p=s(p),l=n(l,p)),("00000000"+(l[0]>>>0).toString(16)).slice(-8)+("00000000"+(l[1]>>>0).toString(16)).slice(-8)+("00000000"+(p[0]>>>0).toString(16)).slice(-8)+("00000000"+(p[1]>>>0).toString(16)).slice(-8)}}])&&e(o.prototype,i),n}()}()})),K="logid_start",Q="4.5.5-web";return function(n){function r(t){var e=n.call(this,t)||this;e.qimei36="",e.uselessCycleTaskNum=0,e.underWeakNet=!1,e.send=function(t,n,r){e.storage.setItem(a,Date.now().toString()),e.network.post(e.uploadUrl||e.strategy.getUploadUrl(),t.data).then((function(r){var o;100==(null===(o=null==r?void 0:r.data)||void 0===o?void 0:o.result)?e.delayTime=1e3*r.data.delayTime:e.delayTime=0,n&&n(t.data),t.data.events.forEach((function(t){e.store.removeEvent(t).then((function(){e.removeSendingId(h(t.mapValue))}))})),e.doCustomCycleTask()})).catch((function(n){var o=t.data.events;e.errorReport.reportError(n.code?n.code.toString():"600",n.message),r&&r(t.data);var i=JSON.parse(e.storage.getItem(s));o.forEach((function(t){i&&-1!=i.indexOf(h(t))&&e.store.insertEvent(t,(function(t,n){t&&e.errorReport.reportError("604","insertEvent fail!")})),e.removeSendingId(h(t))})),e.monitorUploadFailed()}))};var r,o,i=w();return e.isUnderIE8=i>0&&i<8,e.isUnderIE8||(e.isUnderIE=i>0,t.needInitQimei&&e.initQimei(t.appkey),e.network=new F(t),e.storage=new G(t.appkey),e.initCommonInfo(t),e.store=new I(t.appkey,e.storage),e.errorReport=new g(e.config,e.commonInfo,"web",e.network),e.strategy=new m(e.config,e.commonInfo,e.storage,e.network),e.logidStartTime=e.storage.getItem(K),e.logidStartTime||(e.logidStartTime=Date.now().toString(),e.storage.setItem(K,e.logidStartTime)),r=e.logidStartTime,o=Date.now()-Number.parseFloat(r),Math.floor(o/864e5)>=365&&e.storage.clear(),e.initSession(t),e.onDirectUserAction("rqd_js_init",{}),setTimeout((function(){return e.lifeCycle.emit("init")}),0),e.initDelayTime=t.delay?t.delay:1e3,e.cycleTask(e.initDelayTime)),e}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(r,n),r.prototype.initQimei=function(t){var e=this;(new z).getQimei36(t,(function(t){e.qimei36=t.q36}))},r.prototype.initSession=function(t){var e=18e5;t.sessionDuration&&t.sessionDuration>3e4&&(e=t.sessionDuration),this.beaconSession=new b(this.storage,e,this)},r.prototype.initCommonInfo=function(t){var e=Number(this.storage.getItem(a));try{var n=JSON.parse(this.storage.getItem(s));(Date.now()-e>3e4||!n)&&this.storage.setItem(s,JSON.stringify([]))}catch(t){}t.uploadUrl&&(this.uploadUrl=t.uploadUrl+"?appkey="+t.appkey);var r=[window.screen.width,window.screen.height];window.devicePixelRatio&&r.push(window.devicePixelRatio),this.commonInfo={deviceId:this.storage.createDeviceId(),language:navigator&&navigator.language||"zh_CN",query:window.location.search,userAgent:navigator.userAgent,pixel:r.join("*"),channelID:t.channelID?String(t.channelID):"",openid:t.openid?String(t.openid):"",unid:t.unionid?String(t.unionid):"",sdkVersion:Q},this.config.appVersion=t.versionCode?String(t.versionCode):"",this.config.strictMode=t.strictMode},r.prototype.cycleTask=function(t){var e=this;this.intervalID=window.setInterval((function(){e.store.getEvents().then((function(t){var n=[],r=JSON.parse(e.storage.getItem(s));r||(r=[]),t&&t.forEach((function(t){var e=h(t.mapValue);-1==r.indexOf(e)&&(n.push(t),r.push(e))})),0!=n.length&&(e.storage.setItem(s,JSON.stringify(r)),e._normalLogPipeline(e.assembleData(n)))})).catch((function(t){}))}),t)},r.prototype.onReport=function(t,e,n){var r=this;if(this.isUnderIE8)this.errorReport.reportError("601","UnderIE8");else{var o=this.generateData(t,e,n);if(n&&0==this.delayTime&&!this.underWeakNet)this._normalLogPipeline(this.assembleData(o));else{var i=o.shift();i&&this.store.insertEvent(i,(function(t){t&&r.errorReport.reportError("604","insertEvent fail!")})).catch((function(t){r._normalLogPipeline(r.assembleData(o))}))}}},r.prototype.onSendBeacon=function(t,e){if(this.isUnderIE)this.errorReport.reportError("605","UnderIE");else{var n=this.assembleData(this.generateData(t,e,!0));"function"==typeof navigator.sendBeacon&&navigator.sendBeacon(this.uploadUrl||this.strategy.getUploadUrl(),JSON.stringify(n))}},r.prototype.generateData=function(t,n,r){var o=[],i="4.5.5-web_"+(r?"direct_log_id":"normal_log_id"),a=Number(this.storage.getItem(i));return a=a||1,n=e(e({},n),{A99:r?"Y":"N",A100:a.toString(),A72:Q,A88:this.logidStartTime}),a++,this.storage.setItem(i,a.toString()),o.push({eventCode:t,eventTime:Date.now().toString(),mapValue:p(n,this.config.strictMode)}),o},r.prototype.assembleData=function(t){var n=this.beaconSession.getSession();return{appVersion:this.config.appVersion?d(this.config.appVersion):"",sdkId:"js",sdkVersion:Q,mainAppKey:this.config.appkey,platformId:3,common:p(e(e({},this.additionalParams),{A2:this.commonInfo.deviceId,A8:this.commonInfo.openid,A12:this.commonInfo.language,A17:this.commonInfo.pixel,A23:this.commonInfo.channelID,A50:this.commonInfo.unid,A76:n.sessionId,A101:this.commonInfo.userAgent,A102:window.location.href,A104:document.referrer,A119:this.commonInfo.query,A153:this.qimei36}),!1),events:t}},r.prototype.monitorUploadFailed=function(){this.uselessCycleTaskNum++,this.uselessCycleTaskNum>=5&&(window.clearInterval(this.intervalID),this.cycleTask(6e4),this.underWeakNet=!0)},r.prototype.doCustomCycleTask=function(){this.uselessCycleTaskNum>=5&&(window.clearInterval(this.intervalID),this.cycleTask(this.initDelayTime)),this.uselessCycleTaskNum=0,this.underWeakNet=!1},r}(v)}()})),q=function(){function t(t){if(this.type="beacon",!A(t.beacon))throw new Error("\n        [universalReport] beacon must be a beacon application appkey or a beacon instance")}return t.prototype.init=function(t){var e=this;return new Promise((function(n,r){var o;"object"==typeof t.beacon?(e.beacon=t.beacon,n()):"string"==typeof t.beacon?(window.BeaconAction=null!==(o=window.BeaconAction)&&void 0!==o?o:U,n(e.initBeacon(t))):r(new Error("\n          [universalReport] beacon must be a beacon application appkey or a beacon instance"))}))},t.prototype.initBeacon=function(t){var e;try{this.beacon=new window.BeaconAction(r({appkey:t.beacon,versionCode:null!==(e=t.version)&&void 0!==e?e:"",delay:1e3,isDebug:t.debug,onReportFail:function(t){}},t.beaconOptions))}catch(e){null==t||t.beaconFailCallback({err_message:e,result:1,fail_case:"beaconInitFail"})}},t.prototype.report=function(t){var e;if(t.eventName){var r=N(t);t.isSendBeacon?null===(e=this.beacon)||void 0===e||e.onSendBeacon(t.eventName,r):~[n.PGIN,n.PGOUT].indexOf(t.eventName)&&this.beacon.onDirectUserAction?this.beacon.onDirectUserAction(t.eventName,r):this.beacon.onUserAction&&this.beacon.onUserAction(t.eventName,r)}},t}();function B(t){return new q(t)}var V={qqvideo:{android:"8.3.40",ios:"8.3.60"}},H=0,W=1,J=2,F=3,G=["imei","imsi","idfa"],z=function(){function t(t){if(this.type="app",this.beaconReportPool=[],!A(t.beacon))throw new Error("\n        [universalReport] beacon must be a beacon application appkey or a beacon instance");this.appkey="string"==typeof t.beacon?t.beacon:t.beacon.baseInfo.appkey,this.options=t,this.enableBeaconReportRetry=t.enableBeaconReportRetry;try{this.topWindow=window.top,this.topWindow.dtResponseCallbacks={}}catch(t){this.topWindow=window,window.dtResponseCallbacks={}}}return t.prototype.init=function(){var t,e,n,r,o,i,u,c,l,p;return a(this,void 0,void 0,(function(){var a,d,h;return s(this,(function(s){switch(s.label){case 0:return[4,this.waitForDtJsReporterReady()];case 1:return s.sent(),"android"===this.hardwareOS&&(null===(e=null===(t=this.topWindow)||void 0===t?void 0:t.dtBridge)||void 0===e?void 0:e.postMessage)&&(this.nativeReportBridge=this.topWindow.dtBridge),"ios"===this.hardwareOS&&(null===(i=null===(o=null===(r=null===(n=this.topWindow)||void 0===n?void 0:n.webkit)||void 0===r?void 0:r.messageHandlers)||void 0===o?void 0:o.dtBridge)||void 0===i?void 0:i.postMessage)&&(this.nativeReportBridge=this.topWindow.webkit.messageHandlers.dtBridge),(null===(c=null===(u=this.topWindow)||void 0===u?void 0:u.DtJsReporter)||void 0===c?void 0:c.reportEvent)?"android"===this.hardwareOS?[3,3]:(a=this,[4,this.getJsApiCallbackAccess()]):this.nativeReportBridge?[2,Promise.resolve({reason:"native_fallback"})]:[2,Promise.reject({channel:"beacon",reason:"report_event_nil"})];case 2:return a.hasJsApiCallback=s.sent()||!1,this.initFallbackChannel(),[2,Promise.resolve({reason:"report_event_exist"})];case 3:return(null==(d=null===(p=null===(l=this.topWindow)||void 0===l?void 0:l.DtJsReporter)||void 0===p?void 0:p.isSupport)?void 0:d())?(h=this,[4,this.getJsApiCallbackAccess()]):[3,5];case 4:return h.hasJsApiCallback=s.sent()||!1,this.initFallbackChannel(),[2,Promise.resolve({reason:"report_event_exist"})];case 5:return[2,Promise.reject({channel:"beacon",reason:"andorid_not_support"})]}}))}))},t.prototype.initFallbackChannel=function(){this.initBeaconChannel(this.options),this.beaconChannelStatus="init"},t.prototype.getJsApiCallbackAccess=function(){var t=this;return new Promise((function(e){var n;setTimeout((function(){e(!1)}),500),null===(n=t.topWindow.DtJsReporter)||void 0===n||n.getSdkVersion({onCallback:function(t){var n=t.data;e((null==n?void 0:n.sdkVersion)>2100)}})})).catch((function(t){}))},t.prototype.initBeaconChannel=function(t){var e=this;return this.beaconChannel=B(t),Promise.resolve(this.beaconChannel.init(t)).then((function(){e.beaconChannelStatus="ready";for(var t=null;t=e.beaconReportPool.shift();)e.beaconChannel.report(t)})).catch((function(t){}))},t.prototype.waitForDtJsReporterReady=function(){var t=this;return new Promise((function(e){var n,r;if(null===(r=null===(n=t.topWindow)||void 0===n?void 0:n.DtJsReporter)||void 0===r?void 0:r.reportEvent)e();else{var o=setTimeout((function(){e()}),1e3),i=function(){t.topWindow.document.removeEventListener("onDtJsReporterReady",i),clearTimeout(o),e()};t.topWindow.document.addEventListener("onDtJsReporterReady",i)}}))},t.prototype.report=function(t){var e,n,r=this;if(t.isSendBeacon&&"ready"===this.beaconChannelStatus)this.beaconChannel.report(t);else{var o=null===(n=null===(e=this.topWindow)||void 0===e?void 0:e.DtJsReporter)||void 0===n?void 0:n.reportEvent;if(o){var i,a=N(t);this.hasJsApiCallback&&(i=setTimeout((function(){i=null,r.callbackTimeoutHandler(t,J)}),1e3)),o({params:a,eventId:t.eventName,appKey:this.appkey,onCallback:this.nativeCallback(t,i,J)})}else this.nativeReportBridge&&this.nativeReport(t)}},t.prototype.nativeReport=function(t){var e=this;if(this.nativeReportBridge){var n,r=""+Date.now()+Math.random().toString().slice(2,5),o=N(t);n=setTimeout((function(){n=null,e.callbackTimeoutHandler(t,F),delete e.topWindow.dtResponseCallbacks[r]}),1e3);this.topWindow.dtResponseCallbacks[r]=function(o){n&&(e.nativeCallback(t,n,F)(o),delete e.topWindow.dtResponseCallbacks[r])};var i=JSON.stringify({handlerName:"vr_reportEvent",callbackId:r,data:{params:o,eventId:t.eventName,appKey:this.appkey}});this.nativeReportBridge.postMessage(i)}},t.prototype.beaconReport=function(t){this.enableBeaconReportRetry&&("ready"!==this.beaconChannelStatus?this.beaconReportPool.push(t):this.beaconChannel.report(t))},t.prototype.callbackTimeoutHandler=function(t,e){var n,r;this.fallbackReport(t,e),null===(n=this.options)||void 0===n||n.jsApiReportCallback({code:"504",msg:"timeout",step:e,event_type:t.eventName,event_id:null===(r=null==t?void 0:t.publicParams)||void 0===r?void 0:r.dt_eventid_h5})},t.prototype.fallbackReport=function(t,e){e===J&&this.nativeReportBridge?this.nativeReport(t):this.beaconReport(t)},t.prototype.nativeCallback=function(t,e,n){var r=this;return function(o){var i,a,s;e&&clearTimeout(e);var u={ret:"",msg:""};try{u="string"==typeof o?JSON.parse(o):o}catch(t){u={ret:"500",msg:"callback result parse error"}}var c=u.ret,l=u.msg;"200"!==c&&r.fallbackReport(t,n),null===(i=r.options)||void 0===i||i.jsApiReportCallback({code:c,msg:l,step:n,event_type:t.eventName,pgid:null==t?void 0:t.pgid,eid:null===(a=null==t?void 0:t.businessParams)||void 0===a?void 0:a.eid,event_id:null===(s=null==t?void 0:t.publicParams)||void 0===s?void 0:s.dt_eventid_h5})}},t}();var K=function(t){for(var e={},n=document.cookie.split(";"),r=0,o=n.length;r<o;r++){var i=n[r].replace(/^\s+/,"").split("="),a=i[0],s=i[1];e[a]=s}return t?e[t]:e};function Q(t,e){var n=new XMLHttpRequest;n.open("POST",t,!0),n.timeout=1e4,n.setRequestHeader("content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4===n.readyState&&200!==n.status&&n.status},n.ontimeout=function(){n.abort()},n.send(e)}var X=function(){function t(t){if(this.options=t,this.type="boss",!t.bossSet)throw new Error("[universalReport] please specify the bossSet");this.bossSet=t.bossSet}return t.prototype.init=function(){if(!K("txv_boss_uuid")){!function(t,e,n,r,o){var i="";i="string"==typeof n?"; expires="+n:n instanceof Date?"; expires="+n.toUTCString():"; expires="+new Date(Date.now()+6048e5).toUTCString();var a=r||location.hostname,s=o||"/";document.cookie=[t,"=",escape(e),i,";domain=",a,";path=",s].join("")}("txv_boss_uuid",(t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()),new Date(Date.now()+31536e6))}var t},t.prototype.report=function(t){var e=this.bossSet[t.eventName];if(e&&(this.isBeehive(e)||this.isAtta(e))){var n=this.formatBossData(e,t);Q(n.url,n.data)}},t.prototype.formatBossData=function(e,n){var o=[],i=Math.random().toString(36).substr(2,8),a="";this.isBeehive(e)?a=t.bossUrl+"?BossId="+e.BossId+"&Pwd="+e.Pwd+"&_dc="+i:this.isAtta(e)&&(a=t.attaUrl+"?attaid="+e.AttaId+"&token="+e.token+"&_dc="+i);var s=r(r(r({},e),N(n,"kv")),{dc:i});return Object.keys(s).forEach((function(t){o.push(t+"="+encodeURIComponent(s[t]))})),{url:a,data:o.join("&")}},t.prototype.isBeehive=function(t){return void 0!==t.BossId&&void 0!==t.Pwd},t.prototype.isAtta=function(t){return void 0!==t.AttaId&&void 0!==t.token},t.bossUrl="https://btrace.qq.com/kvcollect",t.attaUrl="https://h.trace.qq.com/kv",t}();var Y,$,Z={app:function(t){return new z(t)},beacon:B,boss:function(t){return new X(t)}},tt=Object.keys(Z);($=Y||(Y={}))[$.equal=0]="equal",$[$.low=-1]="low",$[$.high=1]="high";var et=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z-]+(?:\.[\da-z-]+)*)?(?:\+[\da-z-]+(?:\.[\da-z-]+)*)?)?)?$/i;function nt(t){var e,n=t.replace(/^v/,"").replace(/\+.*$/,""),r=("-",-1===(e=n).indexOf("-")?e.length:e.indexOf("-")),o=n.substring(0,r).split(".");return o.push(n.substring(r+1)),o}function rt(t){return isNaN(Number(t))?t:Number(t)}function ot(t){if("string"!=typeof t)throw new TypeError("Invalid argument expected string");if(!et.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}var it=function(){function t(){this.eventsMap={}}return t.prototype.on=function(t,e){var n=this;t.split(",").forEach((function(t){n.eventsMap[t]||(n.eventsMap[t]=[]),n.eventsMap[t].push(e)}))},t.prototype.off=function(t,e){var n=this;t.split(",").forEach((function(t){n.removeListener(t,e)}))},t.prototype.emit=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=[];if(this.eventsMap[t]){var i=this.eventsMap[t].slice();i.forEach((function(r){try{o.push(r.apply(e,n))}catch(n){o.push(null),e.processError(n,t)}}))}return o},t.prototype.use=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],r=t.slice(1);return n.apply(void 0,u([this],r))},t.prototype.processError=function(t,e){},t.prototype.removeListener=function(t,e){if(this.eventsMap[t]){var n=this.eventsMap[t].findIndex((function(t){return t===e}));n>-1&&this.eventsMap[t].splice(n,1)}},t}(),at=function(){},st=function(t){function n(e,n,r,o){void 0===n&&(n=""),void 0===r&&(r=""),void 0===o&&(o="");var i=t.call(this)||this;return i.options=e,i.scenePlat=n,i.sceneVersion=r,i.hardwareOS=o,i.channelReady=!1,i.pool=[],i.loadChannel(e),i}return e(n,t),n.prototype.loadChannel=function(t){this.setChannel(t),this.initChannel(t)},n.prototype.setChannel=function(t){var e=t.channel,n=void 0===e?"app":e;if("qqvideo"===this.scenePlat&&"app"===n&&this.isLowerThanRequiredVersion()&&(n="beacon"),~tt.indexOf(n))this.curChannel=Z[n](t);else if("function"==typeof n)this.curChannel=n(t);else{if("object"!=typeof n)throw new Error("[universalReport] channel must be "+tt.map((function(t){return'"'+t+'"'})).join(", ")+", a function or a object");this.curChannel=n}if("app"===n&&(this.curChannel.hardwareOS=this.hardwareOS),!this.curChannel.report)throw new Error("[universalReport] no report function found in channel")},n.prototype.isLowerThanRequiredVersion=function(){var t,e=null===(t=V[this.scenePlat])||void 0===t?void 0:t[this.hardwareOS];return!!e&&function(t,e){[t,e].forEach(ot);for(var n=nt(t),r=nt(e),o=0;o<Math.max(n.length-1,r.length-1);o++){var i=parseInt(n[o]||"0",10),a=parseInt(r[o]||"0",10);if(i>a)return Y.high;if(a>i)return Y.low}var s=n[n.length-1],u=r[r.length-1];if(s&&u){var c=s.split(".").map(rt),l=u.split(".").map(rt);for(o=0;o<Math.max(c.length,l.length);o++){if(void 0===c[o]||"string"==typeof l[o]&&"number"==typeof c[o])return-1;if(void 0===l[o]||"string"==typeof c[o]&&"number"==typeof l[o])return 1;if(c[o]>l[o])return Y.high;if(l[o]>c[o])return Y.low}}else if(s||u)return s?Y.low:Y.high;return Y.equal}(this.sceneVersion,e)<0},n.prototype.initChannel=function(t){var e,n=this,o=t.channel;Object.assign(t,{beaconFailCallback:function(t){var e=t.fail_case;n.emit(e,t)},jsApiReportCallback:function(t){n.emit("jsApiReport",t)}}),this.curChannel.init=null!==(e=this.curChannel.init)&&void 0!==e?e:at,Promise.resolve(this.curChannel.init(t)).then((function(t){var e;n.emit("initChannel",{report_type:o,result:0,deviceId:(null===(e=n.curChannel.beacon)||void 0===e?void 0:e.getDeviceId())||""}),"app"===n.curChannel.type&&n.emit("jsApiReport",r({step:H,result:"success"},null!=t?t:{})),n.channelReady=!0;for(var i=null;i=n.pool.shift();)i.call(n)})).catch((function(t){var e,o=t,i=o.channel,a=o.reason;if("app"===n.curChannel.type&&n.emit("jsApiReport",{step:H,result:"fail",reason:a}),!("string"==typeof(e=i)&&~tt.indexOf(e)||"function"==typeof e||"object"==typeof e&&"report"in e))throw t;n.loadChannel(r(r({},n.options),{channel:i}))})).catch((function(t){n.emit("initChannel",{report_type:o,result:1,err_message:t})}))},n.prototype.report=function(t){var e=this,n=t.uid,i=o(t,["uid"]),a=r({uid:n},i),s=function(){var t,n,r;e.curChannel.report(i),e.emit("report",a),i.monitoringReport&&e.emit("monitoringReport",{device_id:null===(t=e.curChannel.beacon)||void 0===t?void 0:t.getDeviceId(),report_type:e.curChannel.type,event_type:(null==i?void 0:i.eventName)||"",publicParams:null==i?void 0:i.publicParams}),i.monitoringJsApiReport&&e.emit("jsApiReport",{pgid:null==i?void 0:i.pgid,eid:null===(n=null==i?void 0:i.businessParams)||void 0===n?void 0:n.eid,step:W,event_type:null==i?void 0:i.eventName,report_type:e.curChannel.type,event_id:null===(r=null==i?void 0:i.publicParams)||void 0===r?void 0:r.dt_eventid_h5})};this.channelReady?s():this.pool.push(s)},n}(it),ut=L((function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}Object.defineProperty(e,"__esModule",{value:!0}),e.VirtualNode=void 0;var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e||{},this.parent=null,this.children=[]}return r(t,null,[{key:"childIterator",value:function(t,e){for(var n=[t];n.length>0;){var r=n.shift(),o=e(r);if(!0===o)return o;!1!==o&&(r.children.length>0&&(n=r.children.concat(n)))}}},{key:"parentIterator",value:function(t,e,n){for(;t&&(n=e(t,n),t=t.parent,"boolean"!=typeof n||!n););}},{key:"parentReverseIterator",value:function(t,e,n,r){for(var o=[];t&&(o.push(t),t!==r);)t=t.parent;for(var i=o.length-1;i>=0&&("boolean"!=typeof(n=e(o[i],n))||!n);i--);}}]),r(t,[{key:"setData",value:function(t){Object.assign(this.data,t)}},{key:"mapParent",value:function(t){var e=[];if(this.parent)for(var n=this.parent;n;){var r=n;if("function"==typeof t&&(r=t(n)),"boolean"==typeof r&&r)break;e.push(r),n=n.parent}return e}},{key:"index",value:function(){var t=this.parent;return t?t.children.indexOf(this):0}},{key:"append",value:function(t){t&&(t.remove(),t.parent=this,this.children.push(t))}},{key:"insert",value:function(t,e){var n=this;e&&(e.forEach((function(t){t.remove(),t.parent=n})),Array.prototype.splice.apply(this.children,[t,0].concat(e)))}},{key:"remove",value:function(){var t=this.parent;this.parent=null,t&&(t.children=t.children.filter((function(e){return e.parent===t})))}},{key:"clear",value:function(){if(this.children.length>0){var t=this.children;this.children=[];for(var e=0,n=t.length;e<n;e++){t[e].parent=null}}}},{key:"destroy",value:function(){this.remove()}}]),t}();e.VirtualNode=o}));M(ut);ut.VirtualNode;var ct=L((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.domIterator=function t(e,n,r,o){var i=n(e,r),a=e.childNodes;if("boolean"==typeof i)return i;for(var s=0,u=a.length;s<u;s++){var c=a[s];if(c&&1===c.nodeType){var l=t(c,n,i);if(l)return!0}}},e.domReverseIterator=function t(e,n,r,o){var i=n(e,r),a=e.childNodes;if("boolean"==typeof i)return i;for(var s=a.length-1;s>=0;s--){var u=a[s];if(u&&1===u.nodeType){var c=t(u,n,i);if(c)return!0}}},e.parentIterator=function(t,e,n){for(;t&&(n=e(t,n),t=t.parentNode,"boolean"!=typeof n||!n););},e.parentReverseIterator=function(t,e,n,r){var o=[];for(;t&&(o.push(t),t!==r);)t=t.parentNode;for(var i=o.length-1;i>=0&&("boolean"!=typeof(n=e(o[i],n))||!n);i--);},e.onlyElements=function(t){var e=[];if(t&&t[0])for(var n=t.length-1;n>=0;n--){var r=t[n];1===r.nodeType&&e.unshift(r)}return e}}));M(ct);ct.domIterator,ct.domReverseIterator,ct.parentIterator,ct.parentReverseIterator,ct.onlyElements;var lt=L((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.genHash=function(){return(new Date).getTime()+""+n++},e.debounce=function(t,e){var n=0;return e=e||0,function(){var r=this,o=arguments;clearTimeout(n),n=setTimeout((function(){t.apply(r,o)}),e)}},e.supportIntersectionObserver=void 0;var n=0;var r="undefined"!=typeof window&&window.IntersectionObserver&&window.IntersectionObserverEntry&&("isIntersecting"in window.IntersectionObserverEntry.prototype||"intersectionRatio"in window.IntersectionObserverEntry.prototype);e.supportIntersectionObserver=r}));M(lt);lt.genHash,lt.debounce,lt.supportIntersectionObserver;var pt=L((function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.Emitter=void 0;var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.context=e,this.events={}}var e,r,o;return e=t,(r=[{key:"on",value:function(t,e){var n=this.events[t]||[];return n.push(e),this.events[t]=n,this}},{key:"off",value:function(t,e){if(void 0===e)this.events[t]=[];else for(var n=this.events[t]||[],r=n.length-1;r>=0;r--)if(n[r]===e){n[r]=null;break}return this}},{key:"emit",value:function(t,e,n){var r=!0,o=this.events[t]||[];"boolean"==typeof n&&(r=n);for(var i=o.length-1;i>=0;i--){var a=o[i];if("function"==typeof a)if(r)setTimeout((function(t,e,n){t.call(e,n)}),0,a,this.context,e);else try{a.call(this.context,e)}catch(t){}}return this}},{key:"clear",value:function(){this.events={}}},{key:"listeners",value:function(t){return this.events[t]||[]}}])&&n(e.prototype,r),o&&n(e,o),t}();e.Emitter=r}));M(pt);pt.Emitter;var dt=L((function(t,e){function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e,n){return r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},r(t,e,n||t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function a(t,e){return a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},a(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=l(t);if(e){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return u(this,n)}}function u(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?c(t):e}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.getWindowNode=m,e.VirtualElNode=void 0;var p={},d=1,h=Math.random().toString(36).substring(2),f={click:!0,scroll:!0},v={click:!0},g=null;function m(){return g||((g=new b).scrollLeft=window.scrollX,g.scrollTop=window.scrollY,g.top=0,g.left=0,g.width=window.innerWidth,g.height=window.innerHeight,g.isScroller=!0,g.viewport=g.rect={top:0,left:0,right:window.innerWidth,bottom:window.innerHeight},g.getScrollParent=function(){return null},g.attachScroller=function(t,e){t=t||window;var n=(e=e||{}).throttle,r=function(){var e=t.scrollX-g.scrollLeft,n=t.scrollY-g.scrollTop;g.scrollLeft=t.scrollX,g.scrollTop=t.scrollY,g.moveTree(e,n,!0),g.scrolling=!1,g.emitter.emit("scrollend")};if(n>0){var o=(0,lt.debounce)(r,n);r=function(){g.scrolling=!0,o()}}t.addEventListener("scroll",r)},window.addEventListener("resize",(function(){g.width=window.innerWidth,g.height=window.innerHeight,g.viewport=g.rect={top:0,left:0,right:window.innerWidth,bottom:window.innerHeight},g.emit("resize")})),g)}var y=null;lt.supportIntersectionObserver&&(y=new IntersectionObserver((function(t){t.forEach((function(t){var e=t.target,n=b.getNode(e);if(n){n.rect={top:t.boundingClientRect.top,bottom:t.boundingClientRect.bottom,left:t.boundingClientRect.left,right:t.boundingClientRect.right};var r=void 0!==t.isIntersecting?t.isIntersecting:t.intersectionRatio>0;n.visible!==r&&(n.visible=r,n.width=t.boundingClientRect.width,n.height=t.boundingClientRect.height,n.emit("visibilityChanged",r)),n.recalc()}}))})));var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(n,t);var e=s(n);function n(t,r,o){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(i=e.call(this,o)).uid=0,i.emitter=new pt.Emitter(c(i)),i.unbinds={},i.width=0,i.height=0,i.effectiveWidth=0,i.effectiveHeight=0,i.top=0,i.left=0,i.scrollTop=0,i.scrollLeft=0,i.maxScrollTop=0,i.maxScrollLeft=0,i.maxIntersectArea=0,i.tree=t,i.el=r,i.lazy=!0,i.delegates={},i.visible=!1,i.pt=0,i.pl=0,i.overflowHide=!0,i.isScroller=!1,i.scrolling=!1,i.rect={top:0,left:0,right:0,bottom:0},i.viewport={top:0,left:0,right:0,bottom:0},i.attach(r),i}return i(n,null,[{key:"shouldBeNode",value:function(t){return t&&t.dataset.v}},{key:"getNode",value:function(t){return p[t.__doid]}}]),i(n,[{key:"attach",value:function(t){var e=!1;if(this.detach(),t){var n=t.__doid;e=!n,this.el=t,e&&(n=h+"_"+d++,this.uid=t.__doid=n,p[n]=this),this.updateData(t)}return e}},{key:"detach",value:function(){var t=this.el,e=this.unbinds;if(this.unbinds={},t){var n=t.__doid;n&&(p[n]=null)}this.emitter.clear(),Object.keys(e).forEach((function(t){try{e[t]()}catch(t){}}))}},{key:"updateData",value:function(t,e){if(t=t||this.el)if(e){var n=/data-([\w-]+)/.exec(e),r=n&&n[1];if(r){var o={};o[r]=t.dataset[r],this.setData(o)}}else this.setData(t.dataset),t.dataset.scroller&&this.attachScroller(t)}},{key:"attachScroller",value:function(t,e){var n=this;if(!lt.supportIntersectionObserver){var r=function(){var e=t.scrollLeft-n.scrollLeft,r=t.scrollTop-n.scrollTop;n.scrollTop=t.scrollTop,n.scrollLeft=t.scrollLeft,n.maxScrollTop=Math.max(n.maxScrollTop,n.scrollTop),n.maxScrollLeft=Math.max(n.maxScrollLeft,n.scrollLeft),n.moveTree(e,r,!0),n.scrolling=!1,n.emitter.emit("scrollend")},o=(e=e||{}).throttle;if(o>0){var i=(0,lt.debounce)(r,o);r=function(){n.scrolling=!0,i()}}this.scrollTop=t.scrollTop,this.scrollLeft=t.scrollLeft,this.isScroller=!0,this.on("scroll",r)}}},{key:"getScrollParent",value:function(){for(var t=this.parent;t&&!t.isScroller;)t=t.parent;return t||m()}},{key:"getScrollingParent",value:function(){for(var t=this.getScrollParent();t&&!t.scrolling;)t=t.getScrollParent();return t&&t.scrolling?t:void 0}},{key:"getRect",value:function(){return this.rect}},{key:"recalc",value:function(){var t=this;if(!lt.supportIntersectionObserver){var e=this.el;if(e){var n=this.getScrollParent(),r=this.getScrollingParent();if(r)return this.scrollEndHandle&&r.emitter.off("scrollend",this.scrollEndHandle),this.scrollEndHandle=function(){t.recalc(),r.emitter.off("scrollend",t.scrollEndHandle),t.scrollEndHandle=null},void r.emitter.on("scrollend",this.scrollEndHandle);var o=e.getBoundingClientRect(),i=n.getRect(),a=this.top=o.top-i.top+n.scrollTop,s=this.left=o.left-i.left+n.scrollLeft;this.width=o.width,this.height=o.height,this.isScroller?(this.scrollTop=this.el.scrollTop,this.scrollLeft=this.el.scrollLeft,this.pt=n.pt+a-this.scrollTop,this.pl=n.pl+s-this.scrollLeft,this.effectiveWidth=e.scrollWidth||this.effectiveWidth,this.effectiveHeight=e.scrollHeight||this.effectiveHeight):(this.effectiveWidth=o.width||this.effectiveWidth,this.effectiveHeight=o.height||this.effectiveHeight);var u=this.rect.top!==o.top||this.rect.left!==o.left||this.rect.right!==o.right||this.rect.bottom!==o.bottom;return this.rect.top=o.top,this.rect.left=o.left,this.rect.right=o.right,this.rect.bottom=o.bottom,this.calcViewPort(),this.syncVisible(),u}}}},{key:"move",value:function(t,e){this.isScroller&&(this.pt=this.pt-e,this.pl=this.pl-t);var n=this.rect;n.top=n.top-e,n.left=n.left-t,n.right=n.right-t,n.bottom=n.bottom-e,this.calcViewPort(),this.syncVisible()}},{key:"calcViewPort",value:function(){if(!lt.supportIntersectionObserver){var t=this.rect,e=this.parent||m(),n=this.viewport,r=e.viewport;this.overflowHide?(n.top=Math.max(t.top,r.top),n.left=Math.max(t.left,r.left),n.right=Math.min(t.right,r.right),n.bottom=Math.min(t.bottom,r.bottom)):(n.top=r.top,n.left=r.left,n.right=r.right,n.bottom=r.bottom)}}},{key:"calcExposeArea",value:function(){var t=this.rect,e=this.viewport,n=Math.max(t.left,e.left),r=Math.min(t.right,e.right),o=Math.max(e.bottom-t.top,0);return Math.max(o*(r-n),0)}},{key:"updateNode",value:function(){this.maxScrollTop=this.scrollTop,this.maxScrollLeft=this.scrollLeft,this.effectiveWidth=this.width,this.effectiveHeight=this.height,this.maxIntersectArea=this.calcExposeArea()}},{key:"syncVisible",value:function(){if(!lt.supportIntersectionObserver){var t=this.calcVisible();return t!==this.visible?(this.visible=t,t&&this.updateNode(),this.emitter.emit("visibilityChanged",t),!0):void 0}}},{key:"moveTree",value:function(t,e,r){var o,i=this;if(this.el&&!r&&((0,ct.parentIterator)(this.el,(function(t){if(i.el!==t&&n.getNode(t))return!0;if(1!==t.nodeType)return!0;var e=getComputedStyle(t);return("fixed"===e.position||"sticky"===e.position)&&(o=t,!0)})),o))return;r||this.move(t,e);for(var a=this.children.length-1;a>=0;a--)this.children[a].moveTree(t,e)}},{key:"calcVisible",value:function(){var t=this.rect,e=(this.parent||m()).viewport,n=Math.max(this.calcExposeArea(),this.maxIntersectArea||0);return this.maxIntersectArea=Math.max(n,0),!(t.left>=e.right||t.right<=e.left||t.top>=e.bottom||t.bottom<=e.top)}},{key:"destroy",value:function(){var t=this.el.__doid;this.el.__doid=null,p[t]=null,r(l(n.prototype),"destroy",this).call(this),this.detach()}},{key:"on",value:function(t,e){var r=this,o=this.emitter;if(o.on(t,e),f[t]){var i=this.unbinds,a=this.el;if(!i[t]){if(v[t]){var s=this.tree.root;if(s&&!s.delegates[t]&&s.el){var u=s.delegates[t]=function(e){var r=e.target,o=n.getNode(r);!o||o.lazy||e["_vn_id_"+o.uid]||(o.emitter.emit(t,e,o.lazy),e["_vn_id_"+o.uid]=!0)};s.el.addEventListener(t,u)}}var c=function(e){e["_vn_id_"+r.uid]||(o.emit(t,e,r.lazy),e["_vn_id_"+r.uid]=!0)};a.addEventListener(t,c),i[t]=function(){a.removeEventListener(t,c)}}}else if(lt.supportIntersectionObserver&&"visibilityChanged"===t){var l=this.unbinds;if(!l[t]){var p=this.el;y.observe(p),l[t]=function(){y.unobserve(p)}}}return this}},{key:"off",value:function(t,e){return this.emitter.off(t,e),this}},{key:"emit",value:function(t,e){return this.emitter.emit(t,e),this}}]),n}(ut.VirtualNode);e.VirtualElNode=b}));M(dt);dt.getWindowNode,dt.VirtualElNode;var ht=L((function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}Object.defineProperty(e,"__esModule",{value:!0}),e.VirtualElTree=e.ATTR_MUT_REFLOW_HASH=e.ATTR_MUT_UPDATE_HASH=e.RECALC_HASH=e.TMP_ID=void 0;var o="__tmpid";e.TMP_ID=o;var i="__rechash";e.RECALC_HASH=i;var a="__atmuhash";e.ATTR_MUT_UPDATE_HASH=a;var s="__atmrhash";e.ATTR_MUT_REFLOW_HASH=s;var u=new WeakMap,c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.NodeClass=e||dt.VirtualElNode,this.root=null,this.observer=null,this.rootDom=null}return r(t,null,[{key:"getVtreeMap",value:function(){return u}}]),r(t,[{key:"attach",value:function(t){var e=this,n=this.NodeClass;if(!n.shouldBeNode(t))throw new Error("root should be a node");this.rootDom=t,this.root=n.getNode(t)||new n(this,t),this.update({el:t}),this.reflow({el:t}),this.observer=new MutationObserver((function(t){var n=e.mut(t),r=n.updateArr,o=n.reflowArr;r&&r.length>0&&e.update(r),o&&o.length>0&&e.reflow(o)})),this.observer.observe(t,{characterData:!0,attributes:!0,childList:!0,subtree:!0})}},{key:"detach",value:function(){t.getVtreeMap().delete(this.rootDom),this.remove({all:[this.root.el]},Date.now())}},{key:"update",value:function(t){var e=this,n=(0,lt.genHash)();(t instanceof Array?t:[t]).forEach((function(t){e[t.action||"add"](t,n)}))}},{key:"createTree",value:function(t,e,n){var r=this,o=this.NodeClass,i=[];return(0,ct.domIterator)(t,(function(t,e){if(o.shouldBeNode(t)){var n=o.getNode(t);return n?n.clear():n=new o(r,t),e?e.append(n):i.push(n),n}return e}),n),i}},{key:"add",value:function(t,e){var n=this.NodeClass,r=t.el,o=[];t.all=t.all||[t.el];for(var i=0,a=t.all.length;i<a;i++){var s=t.all[i];o=o.concat(this.createTree(s,e))}if(0!==o.length){var u=null,c=null;(0,ct.parentIterator)(r,(function(t){if(r!==t&&(u=n.getNode(t)))return!0;for(var e=t.previousElementSibling;e&&((0,ct.domReverseIterator)(e,(function(t){if(c=n.getNode(t))return!0})),!c);)e=e.previousElementSibling;return!!c})),!c&&u?u.insert(0,o):c&&(u=u||c.parent)&&u.insert(u.children.indexOf(c)+1,o)}}},{key:"remove",value:function(t){var e=this.NodeClass;t.all=t.all||[t.el];for(var n=0,r=t.all.length;n<r;n++){var o=t.all[n];(0,ct.domIterator)(o,(function(t){var n=e.getNode(t);n&&n.destroy()}))}}},{key:"reflow",value:function(t){var e=this;if(!lt.supportIntersectionObserver){var n=null,r=(0,lt.genHash)(),o=this.NodeClass,i=1===(n=t instanceof Array?t:[t]).length&&o.getNode(n[0]);if(!i){var a={},s=0,u=Math.floor(1e4*Math.random())+"";n.forEach((function(t){var e=t&&t.el;if(e){var n=u+s++;e.__tmpid=n,a[n]=t}}));for(var c=[this.root.el];c.length>0;){var l=c.shift();if(i=o.getNode(l)||i,a[l.__tmpid]&&i)break;l&&l.children&&l.children.length>0&&(c=Array.from(l.children).concat(c))}}i&&(ut.VirtualNode.parentReverseIterator(i,(function(t){if(t.el&&t.el.__rechash!==r&&(t.el.__rechash=r,t.recalc(),e.root!==t))for(var n=t.parent?t.parent.children:[],o=n.indexOf(t),i=n.length;o<i;){var a=n[o];if(ut.VirtualNode.childIterator(a,(function(t){t.el.__rechash!==r&&(t.el.__rechash=r,t.recalc())})))break;o++}}),null,this.root),ut.VirtualNode.childIterator(i,(function(t){i!==t&&t.el.__rechash!==r&&(t.el.__rechash=r,t.recalc())})))}}},{key:"getNearReportNodes",value:function(t){var e=this;return t.map((function(t){var n=t.el,r=e.getSiblingReportNode(n);return r||(0,ct.parentIterator)(n,(function(t){if(r=e.getSiblingReportNode(t))return!0})),r||t}))}},{key:"getSiblingReportNode",value:function(t){for(var e=t,n=null;e&&!(n=this.NodeClass.getNode(e));)e=e.nextElementSibling;return n}},{key:"mut",value:function(t){for(var e=[],n=[],r=(0,lt.genHash)(),o=this.NodeClass,i=t.length-1;i>=0;i--){var a=t[i],s=a.target;if("childList"===a.type){var u=(0,ct.onlyElements)(a.addedNodes),c=(0,ct.onlyElements)(a.removedNodes),l=a.previousSibling;if(u[0]&&e.push({el:u[0],action:"add",all:u}),c[0]&&e.push({el:c[0],action:"remove",all:c}),l&&1!==l.nodeType&&(l=l.previousElementSibling),l){var p=l.nextElementSibling;p?n.push({el:p}):s&&n.push({el:s,ignoreChild:!0})}else s&&n.push({el:s})}else if("attributes"===a.type){if(!s)return;var d=a.attributeName;s.__atmrhash===r||"class"!==d&&"style"!==d||(s.__atmrhash=r,n.push({el:s}));var h=o.getNode(s),f=o.shouldBeNode(s);h&&!f||!h&&f&&(s.__atmuhash!==r&&(s.__atmuhash=r,e.push({el:s,action:"add",all:[s]})),s.__atmrhash!==r&&(s.__atmrhash=r,n.push({el:s}))),h&&h.updateData(s,d,r)}else{if(!s)return;1!==s.nodeType&&(s=s.parentNode),n.push({el:s})}}return{updateArr:e,reflowArr:n}}}]),t}();e.VirtualElTree=c}));M(ht);ht.VirtualElTree,ht.ATTR_MUT_REFLOW_HASH,ht.ATTR_MUT_UPDATE_HASH,ht.RECALC_HASH,ht.TMP_ID;var ft={VirtualNode:ut.VirtualNode,VirtualElTree:ht.VirtualElTree,VirtualElNode:dt.VirtualElNode,ATTR_MUT_HASH:ht.ATTR_MUT_HASH,getWindowNode:dt.getWindowNode,Emitter:pt.Emitter,domHelper:ct},vt=L((function(t,e){function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.kvStringToObject=function(t){var e={};if("string"==typeof t)for(var n=t.split("&"),r=0,o=n.length;r<o;r++){var i=n[r],a=/^([^=]+)=(.*)$/.exec(i);a&&(e[a[1]]=decodeURIComponent(a[2]))}return e},e.objectToKvString=function(t){return Object.keys(t).map((function(e){return e+"="+encodeURIComponent(t[e])})).join("&")},e.isDom=function(t){return"object"===("undefined"==typeof HTMLElement?"undefined":n(HTMLElement))?t instanceof HTMLElement:t&&"object"===n(t)&&1===t.nodeType&&"string"==typeof t.nodeName}}));M(vt);vt.kvStringToObject,vt.objectToKvString,vt.isDom;var gt=L((function(t,e){function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},o(t,e,n||t)}function i(t,e){return i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=u(t);if(e){var o=u(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.ReportNode=void 0;var c=[],l=[],p="data-ofhide",d="data-scroller",h="data-lazy",f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(g,t);var e,s,f,v=a(g);function g(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g),(r=v.call(this,t,e,n)).lazy=!1,r.lastHash=0,r}return e=g,f=[{key:"addConfig",value:function(t){t instanceof Array||(t=[t]);var e={},r=[],o={};c=c.concat(t.map((function(t){var i=t.attrs,a=t.events,s=[];return t.overflowHide&&(p=t.overflowHide),t.isScroller&&(d=t.isScroller),t.lazy&&(h=t.lazy),i&&Object.keys(i).forEach((function(t){var a;e[t]||(e[t]=!0,l.push(t));var s=i[t];if("boolean"==typeof s?a=function(e){var n=!1;return s&&(n=this.data[t]!==e,this.data[t]=e),n}:"JSON"==s?a=function(t){try{this.setData(JSON.parse(t))}catch(t){}return!0}:"KV"==s?a=function(t){return this.setData((0,vt.kvStringToObject)(t)),!0}:"string"==typeof s?a=function(t){var e=this.data[s]!==t;return this.data[s]=t,e}:"object"==n(s)?a=function(e){var n,r=s.prop||t,o=s.dataType;if("JSON"==o)try{n=JSON.parse(e)}catch(t){}else n="KV"==o?(0,vt.kvStringToObject)(e):e;return"cmd"===r&&(this.oldHold=n.hold),this.data[r]=n||{},!0}:"function"==typeof s&&(a=s),a){var u={name:t,func:a};r.push(u),o[t]=u}})),a&&(s=Object.keys(a).map((function(t){var e=a[t],n={name:t,action:e.action},r=e.condition;return"string"==typeof r?(n.condition=function(t){return t[r]},"click"!=t&&(n.keyAttrs=[r])):r instanceof Array?(n.condition=function(t){for(var e=0;r[e];){if(t[r[e]])return!0;e++}return!1},"click"!=t&&(n.keyAttrs=r)):n.condition="function"==typeof r?r:function(){return!0},e.keyAttrs&&(n.keyAttrs=e.keyAttrs),n}))),{arr:r,map:o,events:s}})))}},{key:"shouldBeNode",value:function(t){var e=t.attributes;return!!ft.VirtualElTree.getVtreeMap().get(t)||!!(e[p]||e[d]||e[h])||l.some((function(t){return e[t]}))}}],(s=[{key:"updateData",value:function(t,e,n){var r=this,o=t.attributes,i=function(e){var n=o[e.name];if(n)return e.func.call(r,n.value,t)};c.forEach((function(a){var s=!1;if(void 0===e)a.arr.forEach(i);else{var u=a.map[e];u&&(s=i(u))}a.events.forEach((function(i){var a=i.name;r.off(a,i.action),i.condition.call(r,o,t)&&r.on(a,i.action);var u=i.keyAttrs;u instanceof Array&&e&&s&&u.indexOf(e)>-1&&(!n||n!=r.lastHash)&&(r.lastHash=n,"expose"===a?r.visible&&r.emit(a):r.emit(a))}))})),void 0===e?(this.updateOfData(o,t),this.updateScrollData(o,t),this.updateLazyData(o,t)):e==p?this.updateOfData(o,t):e==d?this.updateScrollData(o,t):e==h&&this.updateLazyData(o,t),this.update(t,e,n)}},{key:"update",value:function(t,e,n){}},{key:"updateOfData",value:function(t,e){var n=t[p];this.overflowHide=!(n&&"false"===n.value)}},{key:"updateScrollData",value:function(t,e){t[d]?this.attachScroller(e):this.off("scroll")}},{key:"updateLazyData",value:function(t,e){var n=t[h];this.lazy=!(!n||"true"!==n.value)}},{key:"on",value:function(t,e){var n=this,r="expose"==t&&this.emitter.listeners("expose").length<=0;return o(u(g.prototype),"on",this).call(this,t,e),r&&o(u(g.prototype),"on",this).call(this,"visibilityChanged",(function(t){t?n.emit("expose"):n.emit("hide")})),this}},{key:"getParam",value:function(t,e){var n=this,r=e||{},o=[];return t.forEach((function(t){(r[t]=r[t]||n.data[t])||o.push(t)})),o.length>=0&&this.mapParent((function(t){var e=t.data||{};return 0===(o=o.filter((function(t){return!(r[t]=e[t])}))).length})),r}}])&&r(e.prototype,s),f&&r(e,f),g}(ft.VirtualElNode);e.ReportNode=f}));M(gt);gt.ReportNode;var mt=L((function(t,e){function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e){return i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var o=c(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t,e,n){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},u(t,e,n||t)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.ReportTree=void 0;var l=null,p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(n,t);var e=a(n);function n(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(r=e.call(this,t||gt.ReportNode)).commonData={},r.pageData={},r.lastPageData={},r}return o(n,null,[{key:"attachGlobal",value:function(t){return l=this.attachDom(document.body,t)}},{key:"attachDom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,e=arguments.length>1?arguments[1]:void 0;if(!(0,vt.isDom)(t))throw new Error('parameter 1 is not of type "Node"');var r=u(c(n),"getVtreeMap",this).call(this).get(t)||null;return r||(r=new this(e),u(c(n),"getVtreeMap",this).call(this).set(t,r),r.attach(t),(0,ft.getWindowNode)().on("resize",(function(){r.reflow(r.root)})),(0,ft.getWindowNode)().attachScroller(window,{throttle:200}),(0,ft.getWindowNode)().append(r.root),r)}},{key:"detachDom",value:function(t){if(!(0,vt.isDom)(t))throw new Error('parameter 1 is not of type "Node"');var e=u(c(n),"getVtreeMap",this).call(this).get(t)||null;e&&(e.observer.disconnect(),e.detach())}},{key:"getGlobalTree",value:function(){return l}}]),o(n,[{key:"pv",value:function(){}},{key:"setCommon",value:function(t){Object.assign(this.commonData,t)}},{key:"setPage",value:function(t){Object.assign(this.pageData,t)}},{key:"setLastPage",value:function(t){Object.assign(this.lastPageData,t)}}]),n}(ft.VirtualElTree);e.ReportTree=p}));M(mt);mt.ReportTree;var yt=mt.ReportTree,bt=gt.ReportNode,wt={ReportTree:yt,ReportNode:bt,getWindowNode:ft.getWindowNode,init:function(t){bt.addConfig(t),yt.attachGlobal()}},_t=function(t,e,n){void 0===e&&(e="expose"),t&&t.length&&t.forEach((function(t){t&&t.visible&&(n?n(t):t.emit(e),_t(t.children,e,n))}))},Pt=function(t){return{top:Math.round(t.top),bottom:Math.round(t.bottom),left:Math.round(t.left),right:Math.round(t.right)}};var kt=function(t){var e,n=null==t?void 0:t.el;return null===(e=null==n?void 0:n.hasAttribute)||void 0===e?void 0:e.call(n,"dt-pgid")},Et=function(t,e){var n,r,o,i;if(t){for(var a=null,s=t;!a&&s;)if(a=null!==(r=null===(n=s.data)||void 0===n?void 0:n[e])&&void 0!==r?r:"",s=s.parent,!a&&kt(s)){a=null!==(i=null===(o=s.data)||void 0===o?void 0:o[e])&&void 0!==i?i:"";break}return a}},Ot=function(t){return t?wt.ReportNode.getNode(t):null};function St(t){var e;Object.assign(t,{observer:wt}),function(t){var e=t.observer,n=t.isEnablePlugin;if(e){var r=e.ReportNode.prototype,o=r.update;if(r.update=function(e,n,r){var i,a;o.call(this,e,n,r);var s=this.data.pgid||"",u=null===(a=null===(i=this.data)||void 0===i?void 0:i.cmd)||void 0===a?void 0:a.hold;"dt-pgid"===n&&this.oldPgid&&s!==this.oldPgid?t.emit("pageIdChange",e,this.oldPgid):"dt-params"===n&&s?t.emit("pageParamsChange",e,s):"dt-cmd"===n&&"false"===u&&u!==this.oldHold&&_t([this],"expose",null),this.oldPgid=s,this.oldHold=u||"false"},n){var i=[],a=!1;t.on("viewPluginReady",(function(){a=!0;for(var t=null;t=i.shift();)t()}));var s=function(t){a?t():i.push(t)},u=r.append;r.append=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=u.apply(this,n);return s((function(){t.emit("mutation",{action:"append",node:e})})),o};var c=r.insert;r.insert=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=c.apply(this,n),i=n[1]||[];return s((function(){t.emit("mutation",{action:"insert",node:e,data:i})})),o};var l=r.updateData;r.updateData=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=l.apply(this,n);return s((function(){var n=e.emitter,r=n.events.click,o=n.events.expose;t.emit("mutation",{action:"updateData",node:e,data:{data:e.data,exp:o?1:void 0,cli:r?1:void 0,of:e.overflowHide?void 0:1}})})),o};var p=r.calcViewPort;r.calcViewPort=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=p.apply(this,n);return s((function(){t.emit("mutation",{action:"calcViewPort",node:e,data:{viewport:Pt(e.viewport)}})})),o};var d=r.recalc;r.recalc=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=d.apply(this,n);return s((function(){t.emit("mutation",{action:"recalc",node:e,data:{viewport:Pt(e.viewport)}})})),o};var h=r.move;r.move=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=h.apply(this,n);return s((function(){t.emit("mutation",{action:"move",node:e,data:{viewport:Pt(e.viewport),rect:Pt(e.rect)}})})),o};var f=r.remove;r.remove=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return s((function(){t.emit("mutation",{action:"remove",node:e})})),f.apply(this,n)};var v=r.clear;r.clear=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return s((function(){t.emit("mutation",{action:"clear",node:e})})),v.apply(this,n)}}}}(t);var o={click:{condition:["dt-eid"],action:function(){var e=Et(this,"pgid"),o=this.data.eid,i=Et(this,"cmd")||{},a="true"===this.data.clckIgnore,s="true"===this.data.sendBeacon;e&&o&&"true"!==i.hold&&!a&&t.reportElement(this.el,{pgid:e,eventName:n.CLCK,eventTime:Date.now(),businessParams:r({eid:o},this.data.params),isSendBeacon:s})}},expose:{condition:["dt-pgid","dt-eid"],action:function(){var e=Et(this,"pgid"),o=Et(this,"cmd")||{};if(e&&"true"!==this.oldHold&&"true"!==o.hold)if(kt(this)){var i="true"===this.data.pgIgnore,a="true"===this.data.pginIgnore;if(i||a)return;var s=t.firstPVReportMap[e];if(t.setFirstPVFlag(e,"reported"),"first_reported"===s)return;t.reportPV(e)}else{var u=this.data.eid,c="true"===this.data.impIgnore,l="true"===this.data.impOnce;if(!u||c||l&&this.data.impReported)return;this.data.impReported=!0,t.reportElement(this.el,{pgid:e,eventName:n.IMP,eventTime:Date.now(),businessParams:r({eid:u},this.data.params)})}}},hide:{condition:["dt-pgid","dt-eid"],action:function(){var e=Et(this,"pgid"),o=Et(this,"cmd")||{};if(e&&"true"!==o.hold)if(kt(this)){var i="true"===this.data.pgIgnore,a="true"===this.data.pgoutIgnore;if(i||a)return;t.reportPgOut(e)}else{var s=this.data.eid,u="true"===this.data.impIgnore||"true"===this.data.impEndIgnore,c="true"===this.data.impOnce;if(!s||u||c&&this.data.impEndReported)return;this.data.impEndReported=!0;var l=this.effectiveWidth*this.effectiveHeight,p=this.isScroller?(this.maxScrollLeft+this.width)*(this.maxScrollTop+this.height):this.maxIntersectArea,d=l?Math.min(p/l,1):0,h=this.el.showTime,f={dt_element_area:l.toFixed(2),dt_ele_imp_area:p.toFixed(2),dt_element_lvtm:h?Date.now()-this.el.showTime:0,dt_ele_imp_rate:d.toFixed(2)};t.reportElement(this.el,{pgid:e,eventName:n.IMPEND,eventTime:Date.now(),publicParams:r({},f),businessParams:r(r({eid:s},D(f)),this.data.params)})}}}};wt.ReportNode.addConfig({isScroller:"dt-scroll",overflowHide:"dt-overflow-hide",lazy:"dt-lazy",attrs:(e={},e["dt-pgid"]="pgid",e["dt-eid"]="eid",e["dt-params"]={prop:"params",dataType:"KV"},e["dt-cmd"]={prop:"cmd",dataType:"KV"},e["dt-pg-ignore"]="pgIgnore",e["dt-pgin-ignore"]="pginIgnore",e["dt-pgout-ignore"]="pgoutIgnore",e["dt-imp-ignore"]="impIgnore",e["dt-imp-end-ignore"]="impEndIgnore",e["dt-clck-ignore"]="clckIgnore",e["dt-send-beacon"]="sendBeacon",e["dt-imp-once"]="impOnce",e),events:o}),Object.assign(t,{eventsConfig:o})}var Rt=Object.prototype.hasOwnProperty;function It(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}var Tt,xt,Ct,At,Nt,jt,Dt={stringify:function(t,e){e=e||"";var n,r,o=[];for(r in"string"!=typeof e&&(e="?"),t)if(Rt.call(t,r)){if((n=t[r])||null!=n&&!isNaN(n)||(n=""),r=encodeURIComponent(r),n=encodeURIComponent(n),null===r||null===n)continue;o.push(r+"="+n)}return o.length?e+o.join("&"):""},parse:function(t){for(var e,n=/([^=?&]+)=?([^&]*)/g,r={};e=n.exec(t);){var o=It(e[1]),i=It(e[2]);null===o||null===i||o in r||(r[o]=i)}return r}},Mt=function(){function t(){this.pageMap={}}return t.prototype.hasPage=function(t){return t&&!!this.pageMap[t]},t.prototype.addPage=function(t){var e,n=null===(e=null==t?void 0:t.pageParams)||void 0===e?void 0:e.pgid,o=x(null==t?void 0:t.pageRoot);if(n&&o){var i=Dt.parse(I("ref_pg")||""),a=Dt.parse(I("ref_ele")||"");this.pageMap[n]=r(r({},t),{pageParams:r({ref_pg:i.pgid?i:{},ref_ele:a.eid?a:{}},t.pageParams),pageRoot:o})}else;},t.prototype.getPage=function(t){return this.hasPage(t)?this.pageMap[t]:null},t.prototype.setPage=function(t){var e,n=null===(e=null==t?void 0:t.pageParams)||void 0===e?void 0:e.pgid,o=this.pageMap[n];this.hasPage(n)&&(this.pageMap[n]=r(r(r({},o),t),{pageParams:r(r({},o.pageParams),t.pageParams)}))},t.prototype.removePage=function(t){this.hasPage(t)&&delete this.pageMap[t]},t.prototype.updatePage=function(t){var e,n;if(this.hasPage(t)){var r=Number(null!==(n=null===(e=this.getPage(t).pageParams)||void 0===e?void 0:e.pg_stp)&&void 0!==n?n:0)+1;this.setPage({pageParams:{pgid:t,pg_stp:r},showTime:Date.now(),clckFlag:"0"})}},t.prototype.fixPgid=function(t){if(t)return t;var e=Object.keys(this.pageMap);return 1===e.length?e[0]:""},t}(),Lt=["dt_omgid"],Ut=function(){function t(t){void 0===t&&(t={}),this.clientInfo=new R(navigator.userAgent).getResult(),this.init();var e=function(t){void 0===t&&(t={});var e=r({qq:/qq\/([\d.]+)/i,wx:/MicroMessenger\/([\w.]+)/i,qqvideo:/QQLive(?:HD)?Browser\/([\d.]+)/,qqnews:/qqnews\/(\d+\.\d+\.\d+)/i,qqreading:/qnreading\/(\d+\.\d+\.\d+)/i,qqbrowser:/MQQBrowser\/(\d+\.\d+)/i,qzone:/Qzone\/[\w\d_]*(\d\.\d)[.\w\d_]*/i,kuaibao:/qnreading\/(\d+\.\d+\.\d+)/i,weibo:/Weibo/i},t),n="",o="";return{scenePlat:Object.keys(e).some((function(t){n=t;var r=navigator.userAgent.match(e[t]);return r&&2===r.length&&(o=r[1]),r}))?n:"",sceneVersion:o}}(t.scenePlat);this.set(r(r({},t.publicParams),{web_version:t.version||"",scenes_plat:e.scenePlat,scenes_version:e.sceneVersion}),"publicParams").set(t.accountInfo||p,"accountInfo")}return t.prototype.init=function(){var t,e,n,r,o,i,a=this.clientInfo,s=a.os,u=a.device,c=a.engine;this.publicParams={platform:(i=this.clientInfo,void 0===i.device.type?"pc":i.device.type),hardware_os:(null===(t=s.name)||void 0===t?void 0:t.toLowerCase())||"",os_version:s.version||"",target_sdk:parseInt(s.version,10)||0,resolution:window.screen.width*window.devicePixelRatio,dpi:C(),brand:(null===(e=u.vendor)||void 0===e?void 0:e.toLowerCase())||"",mf:(null===(n=u.vendor)||void 0===n?void 0:n.toLowerCase())||"",model:(null===(r=u.model)||void 0===r?void 0:r.toLowerCase())||"",web_version:"",web_core_type:(null===(o=c.name)||void 0===o?void 0:o.toLowerCase())||"",web_core_version:c.version||"",web_channel:I("web_channel")||"",scenes_plat:"",network_type:navigator.connection?navigator.connection.effectiveType:"unknown",dt_sdkversion_h5:"3.4.0",dt_omgid:K("video_omgid")||"",dt_omgbzid:"",dt_sessionid_h5:(new Date).getTime()+Math.random().toString().slice(2,5)}},t.prototype.get=function(t){return t?this.publicParams[t]:this.publicParams},t.prototype.set=function(e,n){var r=this;void 0===e&&(e={}),void 0===n&&(n="publicParams");var o=t.checkRules[n];if(o)return Object.keys(e).filter((function(t){return o(t)})).forEach((function(t){r.publicParams[t]=e[t]})),this},t.prototype.remove=function(e){var n=this;void 0===e&&(e="");var r=t.checkRules.publicParams;(Array.isArray(e)?e:[e]).forEach((function(t){r(t,'[universalReport] "'+t+'" cannot be deleted')&&delete n.publicParams[t]}))},t.prototype.getPublicPageParams=function(t){var e,n,r,o;return{url:window.location.href,ref_url:document.referrer,dt_pgid:null!==(e=t.pgid)&&void 0!==e?e:"",dt_ref_pgid:null!==(r=null===(n=t.ref_pg)||void 0===n?void 0:n.pgid)&&void 0!==r?r:"",dt_pgstp:null!==(o=t.pg_stp)&&void 0!==o?o:1}},t.checkRules=((Tt={}).publicParams=function(t,e){var n=-1!==String(t).indexOf("dt_")&&Lt.indexOf(t)<0;return!n},Tt.accountInfo=function(t){return Object.keys(p).includes(t)},Tt),t}(),qt=function(){function t(){this.privateParams={}}return t.prototype.set=function(t,e,n){return void 0===e&&(e=""),void 0===n&&(n=[]),t&&n.length?(this.privateParams[t]={value:e,events:n},this):this},t.prototype.get=function(t){return t?this.privateParams[t]:this.privateParams},t.prototype.remove=function(t){t&&delete this.privateParams[t]},t.prototype.getEventPrivateParams=function(t){return Object.entries(this.privateParams).filter((function(e){return e[1].events.includes(t)})).reduce((function(t,e){var n;return Object.assign(t,((n={})[e[0]]=e[1].value,n))}),{})},t}(),Bt=(xt=new Promise((function(t,e){if(navigator.userAgent.match(/TADChid/i)||!navigator.userAgent.match(/QQLiveBrowser\/([\d.]+)/))return e();var n=setTimeout((function(){e()}),500);window.TenvideoJSBridge?(clearTimeout(n),t()):document.addEventListener("onTenvideoJSBridgeReady",(function(){clearTimeout(n),t()}),!1)})),Ct=!1,At=null,Nt=[],jt=function(){for(var t=null;t=Nt.shift();)t(At);Ct=!0},xt.then((function(){return a(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){if(!window.TenvideoJSBridge)return t(null);window.TenvideoJSBridge.invoke("getDeviceInfo",null,(function(e){var n,r="";try{r=JSON.parse(e)}catch(t){}r.result||t(null),t({os_vrsn:null!==(n=r.result.systemVersion)&&void 0!==n?n:""})}))}))];case 1:return At=t.sent(),jt(),[2]}}))}))})).catch((function(){jt()})),function(t,e,n){return r(r({},n),{value:function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=n.value;Ct?o.apply(this,e):Nt.push((function(n){o.apply(t,u(e,[n]))}))}})}),Vt=function(){function t(t,e){this.options=t,this.channel=new st(r(r({},this.options),{channel:"boss"})),this.init(e)}return t.prototype.init=function(t,e){void 0===e&&(e={}),this.convertPublicParams(t,r(r({},e),this.options.publicParams))},t.prototype.report=function(t){var e=this.convertContext(t);this.channel.report(e)},t.prototype.convertContext=function(t){var e,n,o=t.publicParams,i=this.publicParams,a=null!==(e=t.pageParams)&&void 0!==e?e:{},s=null!==(n=t.businessParams)&&void 0!==n?n:{};return i=r(r({},i),{url:o.url,ref_url:o.ref_url,ei:t.eventName.replace("dt_",""),ctime:t.eventTime,eventid:o.dt_eventid_h5}),!this.options.formatMode&&s.element_params&&(s=s.element_params.reduce((function(t,e){return r(r({},e),t)}),{})),a=T(a,G.concat(["pg_stp"])),i=T(i,G),s=T(s,G),r(r({},t),{publicParams:i,pageParams:a,businessParams:s})},t.prototype.convertPublicParams=function(t,e){var n=["android","ios"].indexOf(t.hardware_os)+1;this.publicParams=r({os:n||"",os_vrsn:n?t.os_version:"",jlbrk:"",network_type:["wifi","2g","3g","4g"].indexOf(t.network_type)+1||5,pt:this.transformPlatform(t.platform,t.hardware_os),qq:t.dt_qq_h5,qq_openid:t.dt_qqopenid_h5,wx_openid:t.dt_wxopenid_h5,wx_commid:"",omgid:t.dt_omgid||K("video_omgid")||"",omgbizid:"",vuserid:"qq"===K("main_login")?K("vqq_vuserid")||K("vuserid")||"":K("vuserid")||"",guid:K("guid")||K("video_guid")||"",uuid:K("txv_boss_uuid")||"",main_login:["wx","qq"].indexOf(t.dt_mainlogin_h5)+1,ptag:I("ptag")||"",sharesource:I("sharesource")||I("shareSource")||"",second_share:I("second_share")||"",bucket_id:K("plat_bucketid")||"",h5_ver:t.web_version,lm_experiment_id:"",sessionid:t.dt_sessionid_h5},e)},t.prototype.transformPlatform=function(t,e){var n=0;return"phone"===t?"android"===e?n=8:"ios"===e&&(n=7):"tablet"===t&&("android"===e?n=6:"ios"===e&&(n=5)),"android"===e&&0===n&&(n=8),n},i([Bt],t.prototype,"init",null),i([Bt],t.prototype,"report",null),t}();function Ht(t){var e=t;e.options.videoReport&&(e.videoReport=new Vt(e.options,e.getPublicParams()))}var Wt={attaUrl:"https://h.trace.qq.com/kv",attaId:"0b300050665",token:"6554817333"},Jt={attaUrl:"https://h.trace.qq.com/kv",attaId:"01600053974",token:"9671122527"};function Ft(t,e){void 0===e&&(e=Wt);try{var n=function(t,e){var n,o=[],i=Math.random().toString(36).substr(2,8);n=e.attaUrl+"?attaid="+e.attaId+"&token="+e.token+"&_dc="+i;var a=encodeURIComponent((""+window.location.host+window.location.pathname).replace(/\./g,"_")),s=r(r({Attaid:e.attaId,token:e.token,url:encodeURIComponent(window.location.href),path:a},t),{dc:i});return Object.keys(s).forEach((function(t){o.push(t+"="+encodeURIComponent(s[t]))})),{url:n,data:o.join("&")}}(t,e);Q(n.url,n.data)}catch(t){throw new Error("[universalReport] atta report fail")}}Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),r=n.length>>>0;if(0===r)return!1;var o,i,a=0|e,s=Math.max(a>=0?a:r-Math.abs(a),0);for(;s<r;){if((o=n[s])===(i=t)||"number"==typeof o&&"number"==typeof i&&isNaN(o)&&isNaN(i))return!0;s++}return!1}}),Object.entries||(Object.entries=function(t){for(var e=Object.keys(t),n=e.length,r=new Array(n);n--;)r[n]=[e[n],t[e[n]]];return r}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},writable:!0,configurable:!0}),Array.from||(Array.from=function(){return[].slice.call(arguments)}());var Gt=function(t){var e=[],n=!1;return t.then((function(){var t;for(n=!0;t=e.shift();)null==t||t()})),function(t,o,i){return r(r({},i),{value:function(){for(var t=this,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var a=i.value;return n?a.apply(this,r):(e.push((function(){a.apply(t,r)})),this)}})}}(new Promise((function(t){"undefined"!=typeof document&&"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){t()})):t()}))),zt=function(t){function a(e){var n=t.call(this)||this;return n.options=e,n.videoReport=null,n.deviceId="",n.monitoringReportId="",n.monitoringReport=!1,n.monitoringJsApiReport=!1,n.enableBeaconReportRetry=!1,n.isEnablePlugin=!1,n.attaPublicParams={},n.firstPVReportMap={},n.eventsConfig={},n.isRealTimeDebug=!1,n.eventId=0,n.checkBrowserEnvironment()?(n.monitoringReportId=e.monitoringReportId,n.monitoringReport=e.monitoringReport,n.monitoringJsApiReport=e.monitoringJsApiReport,n.monitoringReport&&Ft({step:4,monitoring_id:n.monitoringReportId,monitoring_report_id:n.monitoringReportId}),n.setEventHandler(),function(){var t;null===(t=null===document||void 0===document?void 0:document.body)||void 0===t||t.hasAttribute("_eid")}(),n.init().initPlugin().initObserver().initPage().onPageAttrChange().onChannelReport().addPageVisibilityChangeListener(),n.monitoringReport&&(n.bindSdkMonitoringEvent(),Ft(r({step:5},n.attaPublicParams))),n.monitoringJsApiReport&&n.bindJsApiMonitoringEvent(),e.enableSPAMode&&n.addHistoryProxy(),n):n}return e(a,t),a.prototype.init=function(){return this.publicParams=new Ut(this.options),this.attaPublicParams=this.getAttaReportPublicParams(),this.privateParams=new qt,this.pageManager=new Mt,this.channel=new st(this.options,this.publicParams.get("scenes_plat"),this.publicParams.get("scenes_version"),this.publicParams.get("hardware_os")),this.use(Ht),this.monitoringReport&&Ft(r({step:1},this.attaPublicParams)),this},a.prototype.addHistoryProxy=function(){var t=this,e=history&&"function"==typeof history.pushState&&"function"==typeof history.replaceState;e&&["pushState","replaceState"].forEach((function(e){var n=history[e];history[e]=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.switchPage(),n.apply(history,e)}})),window.addEventListener(e?"popstate":"hashchange",(function(){t.switchPage()}))},a.prototype.switchPage=function(t){var e;void 0===t&&(t="");var n=this.pageManager.fixPgid(t),r=null===(e=this.pageManager.getPage(n))||void 0===e?void 0:e.pageRoot;n&&r&&(this.traverseReportHide(r),this.unobserve(n))},a.prototype.bindSdkMonitoringEvent=function(){var t=this;return this.channel&&(this.channel.on("initChannel",(function(e){Ft(r(r({step:0},t.attaPublicParams),e));var n=e.deviceId;t.deviceId=n,t.emit("initChannel",e)})),this.channel.on("beaconInitFail",(function(e){Ft(r(r({step:2},t.attaPublicParams),e))})),this.channel.on("monitoringReport",(function(e){var n=e.publicParams,i=o(e,["publicParams"]);Ft(r(r(r({step:6},t.attaPublicParams),i),{is_return:null==n?void 0:n.dt_pg_isreturn,eid:null==n?void 0:n.dt_eid,event_id:null==n?void 0:n.dt_eventid_h5,omgid:null==n?void 0:n.dt_omgid}))}))),this},a.prototype.bindJsApiMonitoringEvent=function(){var t=this;this.channel.on("jsApiReport",(function(e){Ft(r(r(r({},t.attaPublicParams),e),{appkey:t.options.beacon}),Jt)}))},a.prototype.getAttaReportPublicParams=function(){return{platform:this.publicParams.get("platform"),hardware_os:this.publicParams.get("hardware_os"),os_version:this.publicParams.get("os_version"),session_id:this.publicParams.get("dt_sessionid_h5"),sdk_version:this.publicParams.get("dt_sdkversion_h5"),omgid:this.publicParams.get("dt_omgid"),monitoring_id:this.monitoringReportId,monitoring_report_id:this.monitoringReportId,ua:null===navigator||void 0===navigator?void 0:navigator.userAgent,scenes_plat:this.publicParams.get("scenes_plat"),scenes_version:this.publicParams.get("scenes_version")}},a.prototype.checkBrowserEnvironment=function(){return!!navigator.cookieEnabled},a.prototype.setFirstPVFlag=function(t,e){this.firstPVReportMap[t]=e},a.prototype.initPlugin=function(){if(this.options.isDisableDtPlugin)return this;var t=I(l.REALTIME_DEBUG);return I(l.REPORT_VIEW)===c.ENABLE_FEATURE?(this.loadDtPlugin(),this.setPluginTokenByParam(),this):t===c.ENABLE_FEATURE?(this.dtDebugId=I("dt_debugid"),this.dtAppId=I("dt_appid"),this.isRealTimeDebug=!0,this.loadDtPlugin(),this):(this.loadDtPluginByToken(),this)},a.prototype.setPluginTokenByParam=function(){var t=Date.now()+6048e5;I(l.REPORT_VIEW_SET_TOKEN)===c.ENABLE_FEATURE&&localStorage.setItem(l.REPORT_VIEW_PLUGIN_TOKEN,""+t)},a.prototype.loadDtPluginByToken=function(){var t=localStorage.getItem(l.REPORT_VIEW_PLUGIN_TOKEN);t&&(Date.now()<parseInt(t,10)?this.loadDtPlugin():localStorage.removeItem(l.REPORT_VIEW_PLUGIN_TOKEN))},a.prototype.loadDtPlugin=function(){var t,e=this;this.monitoringReport=!0,this.isEnablePlugin=!0;var n,r,o=this.options.beacon;"string"==typeof o?this.beaconAppkey=o:"object"==typeof o&&(this.beaconAppkey=null===(t=null==o?void 0:o.baseInfo)||void 0===t?void 0:t.appkey),(n="https://vm.gtimg.cn/tencentvideo/script/universal-report-plugin-view.min.js",void 0===r&&(r=Date.now()+"-"+Math.random()),new Promise((function(t,e){if(document.getElementById(r))t(null);else{var o=document.getElementsByTagName("head")[0],i=document.createElement("script"),a=function(){i.onload=null,i.onreadystatechange=null,this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||t(null)};i.onload=a,i.onreadystatechange=a,i.onerror=function(t){i.onerror=null,o.removeChild(i),e(t)},i.src=n,i.id=r,o.appendChild(i)}}))).then((function(){e.use(window.universalReportPluginView,e.isRealTimeDebug)})).catch((function(t){}))},a.prototype.initObserver=function(){return this.use(St),this},a.prototype.initPage=function(t){var e=this,n=t?[t]:document.querySelectorAll("[dt-pgid]");if(!n.length)return this;var o=this.options.contentidSet;return Array.from(n).forEach((function(t){var n,i,a=null===(n=t.getAttribute("dt-pgid"))||void 0===n?void 0:n.trim();if(a&&!e.pageManager.hasPage(a)){var s=o?o[a]:"",u=Dt.parse(null!==(i=t.getAttribute("dt-params"))&&void 0!==i?i:"");if(u.ref_pg){var c=Dt.parse(u.ref_pg);u.ref_pg=c.pgid?c:{}}if(u.ref_ele){var l=Dt.parse(u.ref_ele);u.ref_ele=l.eid?l:{}}s&&(u.contentid=s);var p=r({pgid:a},u);e.setPage(p,t),e.observe(a)}})),this},a.prototype.onPageAttrChange=function(){var t=this;return this.on("pageIdChange",(function(e,n){t.pageManager.removePage(n),t.observer.ReportTree.detachDom(e),t.initPage(e)})),this.on("pageParamsChange",(function(e,n){var o,i=Dt.parse(null!==(o=e.getAttribute("dt-params"))&&void 0!==o?o:""),a=i.ref_pg,s=i.ref_ele;a&&(i.ref_pg=Dt.parse(a)),s&&(i.ref_ele=Dt.parse(s)),t.setPageParams(r({pgid:n},i))})),this},a.prototype.setEventHandler=function(){var t=this;this.pageVisibilityHandler=function(){"hidden"===document.visibilityState&&t.reportPgOut("",!0),"visible"===document.visibilityState&&t.reportPV()}},a.prototype.addPageVisibilityChangeListener=function(){return!this.options.isDisableVisibilitychangeListener&&document.addEventListener("visibilitychange",this.pageVisibilityHandler),this},a.prototype.removePageVisibilityChangeListener=function(){return document.removeEventListener("visibilitychange",this.pageVisibilityHandler),this},a.prototype.onChannelReport=function(){var t=this;return this.channel.on("report",(function(e){t.emit("report",{type:"dt",event:e.eventName,data:N(e),uid:e.uid,eventTime:e.eventTime})})),this},a.prototype.setPage=function(t,e){var n=null==t?void 0:t.pgid;return this.pageManager.hasPage(n)||this.pageManager.addPage({pageParams:t,pageRoot:e}),this},a.prototype.reportPV=function(t){var e,o,i,a=this.pageManager.fixPgid(t),s=null===(e=this.pageManager.getPage(a))||void 0===e?void 0:e.pageRoot,u=Ot(s),c=null===(o=null==u?void 0:u.data)||void 0===o?void 0:o.pgIgnore,l=null===(i=null==u?void 0:u.data)||void 0===i?void 0:i.pginIgnore,p=null==u?void 0:u.uid;if(this.monitoringReport&&Ft(r({step:8,pgid:a,report_node:!!u,pg_ignore:c},this.attaPublicParams)),!a||!u||c||l)return this;u.updateNode(),this.pageManager.updatePage(a);var d=this.pageManager.getPage(a).pageParams,h=d.contentid,f=d.last_contentid;if(h){var v=0;f===h?v=1:this.pageManager.setPage({pageParams:{pgid:a,last_contentid:h}}),this.privateParams.set("dt_pg_isreturn",v,[n.PGIN])}else this.privateParams.remove("dt_pg_isreturn");return this.reportEvent({pgid:a,uid:p,eventName:n.PGIN,eventTime:Date.now()}),this},a.prototype.reportPgOut=function(t,e,r){var o,i,a,s,u;void 0===r&&(r={});var c=this.pageManager.fixPgid(t),l=this.pageManager.getPage(c),p=Ot(null==l?void 0:l.pageRoot),d=null===(o=null==p?void 0:p.data)||void 0===o?void 0:o.pgIgnore,h=null===(i=null==p?void 0:p.data)||void 0===i?void 0:i.pgoutIgnore,f=null==p?void 0:p.uid;if(!c||!l||!p||d||h)return this;var v=null!==(a=null==r?void 0:r.area)&&void 0!==a?a:p.effectiveWidth*p.effectiveHeight,g=null!==(s=null==r?void 0:r.impArea)&&void 0!==s?s:p.maxIntersectArea,m=v?Math.min(g/v,1):0,y={dt_pg_area:v.toFixed(2),dt_pg_imp_area:g.toFixed(2),dt_lvtm:l.showTime?Date.now()-l.showTime:0,dt_clck_flag:null!==(u=l.clckFlag)&&void 0!==u?u:"0",dt_pg_imp_rate:m.toFixed(2)};return this.reportEvent({pgid:c,uid:f,eventName:n.PGOUT,eventTime:Date.now(),publicParams:y,pageParams:D(y),isSendBeacon:e}),this},a.prototype.traverseReport=function(t,e){var n=this,r=x(t),o=Ot(r);o&&_t([o],e,(function(t){var r;null===(r=null==n?void 0:n.eventsConfig[e])||void 0===r||r.action.apply(t)}))},a.prototype.traverseReportHide=function(t){this.traverseReport(t,"hide")},a.prototype.traverseReportExpose=function(t){this.traverseReport(t,"expose")},a.prototype.reportElement=function(t,e){var o,i=x(t),a=null===(o=null==e?void 0:e.businessParams)||void 0===o?void 0:o.eid;if(!a||!i)return this;var s=this.pageManager.fixPgid(null==e?void 0:e.pgid),u=null==e?void 0:e.eventName,c=this.pageManager.hasPage(s),l=[n.IMP,n.IMPEND,n.CLCK].includes(u),p={};if(!c||!l)return this;var d=function(t){for(var e=t,n=null;!n&&e&&e.hasAttribute&&!e.hasAttribute("dt-pgid");)e=e.parentNode,n=Ot(e);return n}(i),h=j(d,this.options.formatMode,r({},e.businessParams));u===n.CLCK?this.pageManager.getPage(s).clckFlag="1":u===n.IMP?i.showTime=Date.now():p=function(t){if(!t)return{};var e=t.scrollWidth*t.scrollHeight,n=(t.scrollLeft+t.clientWidth)*(t.scrollTop+t.clientHeight),r=e?Math.min(n/e,1):0,o=t.showTime;return{dt_element_area:e.toFixed(2),dt_ele_imp_area:n.toFixed(2),dt_element_lvtm:o?Date.now()-o:0,dt_ele_imp_rate:r.toFixed(2)}}(i);var f=Ot(i),v=null==f?void 0:f.uid;return this.reportEvent(r(r({pgid:s,uid:v,eventTime:Date.now()},e),{publicParams:r(r({dt_eid:a},p),e.publicParams),businessParams:r(r({},D(p)),h)})),this},a.prototype.reportEvent=function(t){var e,n;void 0===t&&(t={});var o=t;this.monitoringReport&&(Ft(r(r({step:3},this.attaPublicParams),{page_params:JSON.stringify((null==o?void 0:o.pageParams)||{}),event_type:null==o?void 0:o.eventName})),Object.assign(o,{monitoringReport:!0})),this.monitoringJsApiReport&&Object.assign(o,{monitoringJsApiReport:!0});var i=null==o?void 0:o.eventName,a=null==o?void 0:o.uid;if(o.eventTime=(null==o?void 0:o.eventTime)||Date.now(),o.publicParams=null!==(e=o.publicParams)&&void 0!==e?e:{},o.publicParams.dt_eventid_h5=this.eventId,this.isRealTimeDebug&&Object.assign(o.publicParams,{dt_debugid:this.dtDebugId,dt_uid:a,dt_appid:this.dtAppId}),this.eventId+=1,!i)return this;var s=this.formatContext(o);return this.channel.report(s),null===(n=this.videoReport)||void 0===n||n.report(s),this},a.prototype.reportBeaconEvent=function(t){return void 0===t&&(t={}),Object.assign(t,{isSendBeacon:!0}),this.reportEvent(t)},a.prototype.observe=function(t){var e,n=this.pageManager.fixPgid(t),r=null===(e=this.pageManager.getPage(n))||void 0===e?void 0:e.pageRoot;return n&&r?(r.hasAttribute("dt-pgid")||r.setAttribute("dt-pgid",n),this.observer.ReportTree.attachDom(r),this.firstPVReportMap[n]||"true"===r.getAttribute("dt-pg-ignore")||"true"===r.getAttribute("dt-pgin-ignore")||"hold=true"===r.getAttribute("dt-cmd")||(this.setFirstPVFlag(n,"first_reported"),this.reportPV(n)),this):this},a.prototype.unobserve=function(t){var e,n=this.pageManager.fixPgid(t),r=null===(e=this.pageManager.getPage(n))||void 0===e?void 0:e.pageRoot;return n&&r?(r.removeAttribute("dt-pgid"),this.pageManager.removePage(n),this.observer.ReportTree.detachDom(r),this.firstPVReportMap[n]=null,this):this},a.prototype.formatContext=function(t){var e,n=this.pageManager.fixPgid(null==t?void 0:t.pgid),o=null==t?void 0:t.eventName,i=null===(e=null==t?void 0:t.businessParams)||void 0===e?void 0:e.eid,a=this.getPageParams(n),s=this.getPublicParams(),u=this.privateParams.getEventPrivateParams(o),c=this.publicParams.getPublicPageParams(a),l=T(r(r(r(r(r(r({},i?{dt_eid:i}:null),s),u),c),{dt_pgid:n}),t.publicParams),G),p=T(r(r({},a),t.pageParams),G),d=T(t.businessParams||{},G);return r(r({},t),{eventName:o,pgid:n,publicParams:l,pageParams:p,businessParams:d})},a.prototype.getReportParams=function(t,e){void 0===e&&(e=this.options.formatMode);var n=x(t);if(!n)return"";var o=Ot(n);if(!o)return"";var i=Et(o,"pgid"),a=o.data.eid;if(!i||!a)return"";var s=j(o,e,r({eid:a},o.data.params)),u=this.formatContext({pgid:i,businessParams:s});return N(u).udf_kv},a.prototype.setPageParams=function(t){return this.pageManager.setPage({pageParams:t}),this},a.prototype.getPageParams=function(t,e){var n,r,o,i=this.pageManager.fixPgid(t);if(!i)return{};var a=null!==(r=null===(n=this.pageManager.getPage(i))||void 0===n?void 0:n.pageParams)&&void 0!==r?r:{};return e?null!==(o=a[e])&&void 0!==o?o:"":a},a.prototype.getPublicParams=function(t){return this.publicParams.get(t)},a.prototype.setPublicParams=function(t,e){var n;return void 0===t&&(t={}),void 0===e&&(e="publicParams"),this.publicParams.set(t,e),null===(n=this.videoReport)||void 0===n||n.convertPublicParams(this.getPublicParams(),"publicParams"===e?t:{}),this},a.prototype.removePublicParams=function(t){return void 0===t&&(t=""),this.publicParams.remove(t),this},a.prototype.setAccountInfo=function(t){return this.setPublicParams(t,"accountInfo"),this},a.prototype.clearAccountInfo=function(){return this.setPublicParams(p,"accountInfo"),this},a.prototype.setCommand=function(t,e){var n,o=x(t);if(!o||!e)return this;var i=Dt.parse(null!==(n=o.getAttribute("dt-cmd"))&&void 0!==n?n:"");o.setAttribute("dt-cmd",Dt.stringify(r(r({},i),e)))},a.prototype.setPageContentId=function(t){if(t)return this.privateParams.set("dt_pg_contentid",t,[n.PGIN,n.PGOUT,n.IMP,n.IMPEND,n.CLCK]),this},a.prototype.setMultiPageContentids=function(t){var e=this;if(t)return Object.keys(t).forEach((function(n){if(e.pageManager.hasPage(n)){var r=t[n];e.pageManager.setPage({pageParams:{pgid:n,contentid:r}})}})),this},i([Gt],a.prototype,"initObserver",null),i([Gt],a.prototype,"initPage",null),i([Gt],a.prototype,"reportPV",null),i([Gt],a.prototype,"reportEvent",null),i([Gt],a.prototype,"reportBeaconEvent",null),i([Gt],a.prototype,"observe",null),i([Gt],a.prototype,"unobserve",null),a}(it);return zt}));
