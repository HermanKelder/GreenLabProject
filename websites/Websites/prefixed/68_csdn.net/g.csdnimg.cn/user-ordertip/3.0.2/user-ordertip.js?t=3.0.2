"use strict";!function(e,i,a){function t(e,i){return(100*e-100*i)/100}function o(e,t){QRCode?t.pay_url&&(w=t.pay_url,a("#ordertip_qr_code").html(""),a("#ordertip_notify").hide(),new QRCode(i.getElementById("ordertip_qr_code"),{text:t.pay_url,width:130,height:130})):console.warn("qrcode脚本不存在，请检查！")}function r(e,t,o){t=isNaN(t)?3e3:t;var r=i.createElement("div");r.innerHTML=e,r.style.cssText="width:124px;opacity: 0.8;height: 40px;background:rgba(34,34,38,1);color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 35%;left:50%;margin-left:-62px;z-index: 999999;font-size: 16px;",i.getElementById("user-ordertip").appendChild(r),setTimeout(function(){r.style.webkitTransition="-webkit-transform 0.5s ease-in, opacity 0.5s ease-in",r.style.opacity="0",setTimeout(function(){i.getElementById("user-ordertip").removeChild(r),o&&(a("#user-ordertip-box").remove(),window.location.reload())},500)},t)}function d(){x="",l("pay_error","已扫码<br>请在手机端操作",x)}function n(){x="code_2",l("pay_error","获取失败,点击重试",x)}function s(){x="",l("pay_time_out","点击重新获取",x)}function l(e,i,t){a("#ordertip_notify").show().html('<img class="pay_icon" src="https://csdnimg.cn/release/download/images/'+e+'.png"/><span class="pay_tip">'+i+"</span>"),a("#ordertip_qr_code").html('<img src="https://csdnimg.cn/public/static/img/csdn-userimg250.gif" width="130" height="130"/>'),a("#ordertip_notify").find(".pay_icon, .pay_tip").off("click").on("click",function(){"code_2"==t&&r("支付失败","2000",!1),I.refearch(v.data)})}function c(){r("支付成功","2000",!0)}var p="http"===location.protocol.substr(0,4)?"":"https:",_=p+"//g.csdnimg.cn/user-ordertip/3.0.2/images",g=p+"//g.csdnimg.cn/user-ordertip/3.0.2/user-ordertip.css";!function(e){var a=i.createElement("link");a.rel="stylesheet",a.type="text/css",a.href=e,i.getElementsByTagName("head")[0].appendChild(a)}(g),e.userOrderTip=e.userOrderTip?e.userOrderTip:{};var u=!0,v={},m={},f={},h="",w="",b="",x="",y={},k={},C={},I={init:function(){this.checkPopup()},bindEvents:function(){a(i).off("click",".ordertip_dialog_wrapper .user_balance").on("click",".ordertip_dialog_wrapper .user_balance",function(){if(a(".ordertip_dialog_wrapper .user_balance").hasClass("disable"))return void(u=!1);a(".ordertip_dialog_wrapper .user_balance").hasClass("active")?(a(".ordertip_dialog_wrapper .user_balance").removeClass("active"),u=!1):(a(".ordertip_dialog_wrapper .user_balance").addClass("active"),u=!0);var e=v.data.new_price-v.data.available_amount<0?0:t(v.data.new_price,v.data.available_amount),i=Number(u?e:v.data.new_price).toFixed(2);v.data.new_price>0&&a(".ordertip_dialog_wrapper .amount_actually .num b").html(i),i>0?(a(".ordertip_dialog_wrapper .recharge_mode").removeClass("hid"),a(".ordertip_dialog_wrapper .btn").removeClass("via")):0==i&&(a(".ordertip_dialog_wrapper .recharge_mode").addClass("hid"),a(".ordertip_dialog_wrapper .btn").addClass("via")),I.checkPopup_1({goods_id:v.data.goods_id,product_id:v.data.product_id,flag:v.data.flag})}),a(i).off("click",".btn").on("click",".btn",function(e){window.location.href=""+w}),a(i).off("click",".agree img").on("click",".agree img",function(e){window.open("https://blogdev.blog.csdn.net/article/details/109030727","_blank")}),a(i).off("click",".titl").on("click",".titl",function(e){b="28",I.showNav(b),a(".dialog_vip").removeClass("color_gold"),a(".ordertip_dialog_wrapper .eBooks_1").addClass("color_gold"),v={},console.log(f[0].ext.goodsId),u=!0,I.checkPopup_1({goods_id:f[0].ext.goodsId,product_id:f[0].ext.productId,flag:f[0].ext.flag})}),a(i).off("click",".ti").on("click",".ti",function(e){b="",v={},u=!0,I.showNav(b);var i="",t=m.filter(function(e,a,t){return 1==e.ext.default&&(i=a+1),1==e.ext.default});a(".dialog_vip").removeClass("color_gold"),a(".vip_"+i).addClass("color_gold"),I.checkPopup_1({goods_id:t[0].ext.goodsId,product_id:t[0].ext.productId,flag:t[0].ext.flag})}),a(i).off("click",".dialog_vip").on("click",".dialog_vip",function(e){a(".ordertip_dialog_ka .dialog_vip").removeClass("color_gold"),a(".ordertip_dialog_ka_1 .dialog_vip").removeClass("color_gold"),a(this).addClass("color_gold"),v={},u=!0,"1"==a(this).attr("isContract")?a(".ordertip_dialog_wrapper .agree").addClass("inlineBlock"):a(".ordertip_dialog_wrapper .agree").removeClass("inlineBlock"),I.checkPopup_1({goods_id:a(this).attr("goods_id"),product_id:a(this).attr("product_id"),flag:a(this).attr("flag")})}),a(i).on("click",".dialog_headerbtn",function(e){a("#user-ordertip-box").remove(),m={},f={},y={},k={}}),a(i).on("click",".user_ordertip_dialog",function(e){a(e.target).hasClass("user_ordertip_dialog")&&(a("#user-ordertip-box").remove(),m={},f={},y={},k={})})},initDialog:function(e){I.bindEvents(),I.createDialogFn(e)},initDialog_1:function(e){I.bindEvents(),a(".ordertip_dialog_wrapper .ordertip_dialog_title span").html(e.name),a(".ordertip_dialog_wrapper .gift span").html(e.discount_msg),a(".ordertip_dialog_wrapper .commodity_box .user_balance .num").html(e.available_amount),a(".ordertip_dialog_wrapper .commodity_box .amount_actually em i").html(e.old_price),a(".ordertip_dialog_wrapper .amount_actually .num b").html(e.new_price),this.discountMsg(e),e.available_amount>0&&u?a(".ordertip_dialog_wrapper .user_balance").addClass("active"):(a(".ordertip_dialog_wrapper .user_balance").removeClass("active"),u=!1);var i=v.data.new_price-v.data.available_amount<0?0:t(v.data.new_price,v.data.available_amount),o=Number(u?i:v.data.new_price).toFixed(2);v.data.new_price>0&&a(".ordertip_dialog_wrapper .amount_actually .num b").html(o),o>0?(a(".ordertip_dialog_wrapper .recharge_mode").removeClass("hid"),a(".ordertip_dialog_wrapper .btn").removeClass("via")):0==o&&(a(".ordertip_dialog_wrapper .recharge_mode").addClass("hid"),a(".ordertip_dialog_wrapper .btn").addClass("via")),window.cart?this.validateCode(e):console.warn("cart_jsonp脚本不存在，请检查！")},refearch:function(e){u=!0,I.checkPopup_1({goods_id:v.data.goods_id,product_id:v.data.product_id,flag:v.data.flag})},createDialogFn:function(i){this.createMask();u=i.available_amount>0;var t='<div id="user-ordertip">\n      <div class="user_ordertip_dialog">\n          <div class="ordertip_dialog_wrapper"  data-report-view=\'{"mod":"1597140593_002","spm":"3001.4292"}\'>\n              <div class="dialog_header">\n                  <div class="dialog_title">\n                    <div  class="ti"   data-report-view=\'{"mod":"1597140593_002","spm":"3001.4292","extend1":"CSDN会员"}\' data-report-click=\'{"mod":"1597140593_002","spm":"3001.4292","extend1":"CSDN会员"}\' > CSDN会员\n                      <div  class="titl_1"></div>\n                    </div>\n                  <div  class="titl"  data-report-view=\'{"mod":"1602731088","spm":"3001.4444","extend1":"电子书会员"}\'    data-report-click=\'{"mod":"1602731088","spm":"3001.4444","extend1":"电子书会员"}\'  >电子书会员\n                  <div  class="titl_2"></div>\n                  </div>\n              </div>\n                  <p  class="dialog_headerbtn"> + </p> \n              </div>\n              <div class="ordertip_dialog_wrap">\n              <div class="ordertip_dialog_ka">\n\n              </div>\n              <div class="ordertip_dialog_ka_1">\n                <div   class="'+("2"==f.length?"two":"forty")+'">\n                 \n                </div>\n             </div>\n              <div class="ordertip_dialog_header">\n                  <p class="ordertip_dialog_title">\n                     <span> '+i.name+' </span><i class="vip_qy"   > <img  src="'+_+'/vip.png" alt=""> 权益详情</i>\n                    \n                  </p>\n              </div>\n              <div class="ordertip_dialog_body">\n                  <li class="recharge_mode">\n                      <div class="recharge_mode_qr_code" id="ordertip_qr_code">\n                          <img class="loading" src="'+_+'/checked.png" width="50" height="50">\n                      </div>\n                      <div id="ordertip_notify" class="pay_notify"></div>\n                      <p class="scan_code">\n                          <img class="icon_item"\n                              src="https://csdnimg.cn/release/mall/7315efb/dist/images/dl_vip/wx.png" alt="img">\n                          <img class="icon_item"\n                              src="https://csdnimg.cn/release/mall/7315efb/dist/images/dl_vip/zfb.png" alt="img">\n                          <img class="icon_item"\n                              src="https://csdnimg.cn/release/mall/7315efb/dist/images/dl_vip/jd.png" alt="img">\n                          <span class="pay_intro">扫码支付</span>\n                      </p>\n                  </li>\n                  <div class="commodity_box">\n                      <ul class="commodity_desc">\n                          <li class="amount_actually">\n                              实付金额<span class="num">¥ <b>'+i.new_price+"</b></span><em>原价<i>"+i.old_price+'</i>元</em>\n                          </li>\n                          <li class="gift"  ><img   src="'+_+'/enjoy.png" alt=""> <span> '+i.discount_msg+' </span>\n                          </li>\n                          <li class="user_balance '+(0!=i.available_amount?"active":"disable")+'">\n                          <img src="'+_+'/unchecked.png" alt="" class="unchecked">\n                              <img src="'+_+'/checked.png" alt="" class="checked">\n                              钱包余额 <b class="num">'+i.available_amount+'</b>\n                              <div class="balance_tips_box">\n                                  <img src="'+_+'/help.png" alt="" class="help">\n                                  <span class="balance_tips">\n                                      <i class="chat"></i>\n                                      <b>抵扣说明：</b>\n                                      <em>1、余额是钱包充值的虚拟货币，按照1:1的比例进行支付金额的抵扣；</em>\n                                      <em>2、余额无法直接购买下载，可以购买VIP、C币套餐及课程；</em>\n                                  </span>\n                              </div>\n                          </li>\n                          <li class="agree  active" >\n                          支付即同意自动续费协议，自动续费15元/月，可随时取消<img src="'+_+'/help.png" alt="" class="help">\n                          </li>\n                          <li  class="btn"> \n                          确定支付\n                          </li>  \n                      </ul>\n                  </div>\n              </div>\n              </div>\n          </div>\n      </div>\n      <div class="ordertip_mask"></div>\n  </div>\n      ',o=a(t);a("#user-ordertip-box").append(o),y.vipActivityId&&"ecsdnpac"==y.vipActivityId&&a(".titl").remove();var r="";m.forEach(function(e,i){r+=' <div class="dialog_vip vip_'+(i+1)+"  "+(e.ext.default?"color_gold":"")+"  "+(i==m.length-1?"vip_margin_1":"")+"  "+(0==i?"vip_margin":"")+'" product_id="'+e.ext.productId+'" flag="'+e.ext.flag+'" goods_id="'+e.ext.goodsId+'" data-report-click=\'{"mod":"1597140593_002","spm":"3001.4292","extend1":"'+e.ext.price.split(".")[0]+'"}\'>\n                    <div class="vip_ka"> '+e.title.split("：")[0]+'</div>\n                    <p class="vip_meony"><span class="meony">¥</span> '+e.ext.price.split(".")[0]+'</p>\n                    <div class="'+(e.ext.default?"vip_tj":"no")+'" >推荐</div>\n                </div>'});var d=a(r);a(".ordertip_dialog_ka").append(d);var n="";f.forEach(function(e,i){n+='<div class="dialog_vip eBooks_'+(i+1)+'"  product_id="'+e.ext.productId+'" flag="'+e.ext.flag+'" goods_id="'+e.ext.goodsId+'" isContract="'+e.ext.isContract+'" data-report-click=\'{"mod":"1602731088","spm":"'+(1==e.ext.isContract?"3001.4445":"3001.4446")+'","extend1":"'+e.title+'"}\'>\n                <div class="vip_ka"> '+e.title.split("：")[0]+'</div>\n                <div class="vip_meony"><span class="meony">¥</span>'+Number(1==e.ext.isFirstOrder?e.ext.firstOrderPrice:e.ext.price).toFixed(1)+'\n                <i   class="'+("1"==e.ext.isContract?"monthy":"no")+'"  >连续包月￥'+(1==e.ext.isContract?e.ext.price:e.ext.originalPrice)+'/月 <i  class="'+("1"==e.ext.isFirstOrder?"vip_tj_1":"no")+'"  >首单特惠</i> </i>\n                <em   class="'+("0"==e.ext.isContract?"":"no")+'"  >原价'+e.ext.originalPrice+'元  </em>\n                </div>\n                <div class="'+("1"==e.ext.isContract?"vip_tj":"no")+'" >自动续费</div>\n            </div>'});var s=a(n);4==f.length?a(".forty").append(s):2==f.length&&a(".two").append(s),this.discountMsg(i),this.showNav(b),"28"==b&&(a(".dialog_vip").removeClass("color_gold"),"3942"==i.goods_id?a(".ordertip_dialog_wrapper .eBooks_2").addClass("color_gold"):a(".ordertip_dialog_wrapper .eBooks_1").addClass("color_gold")),e.report&&window.csdn.report.viewCheck(),this.newPrice(),window.cart?this.validateCode(i):console.warn("cart_jsonp脚本不存在，请检查！")},showNav:function(e){"28"==e?(a(".ordertip_dialog_wrapper .titl").addClass("font_2"),a(".ordertip_dialog_wrapper  .ti").removeClass("font"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka").addClass("no"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka_1").addClass("display"),a(".ordertip_dialog_wrapper .agree").addClass("inlineBlock")):(a(".ordertip_dialog_wrapper .ti").addClass("font"),a(".ordertip_dialog_wrapper  .titl").removeClass("font_2"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka").removeClass("no"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka_1").removeClass("display"),a(".ordertip_dialog_wrapper .agree").removeClass("inlineBlock"))},discountMsg:function(e){e.discount_msg?a(".gift").show():a(".gift").hide()},newPrice:function(e){if(u){var i=v.data.new_price-v.data.available_amount<0?0:t(v.data.new_price,v.data.available_amount),o=Number(u?i:v.data.new_price).toFixed(2);v.data.new_price>0&&a(".ordertip_dialog_wrapper .amount_actually .num b").html(o),o>0?(a(".ordertip_dialog_wrapper .recharge_mode").removeClass("hid"),a(".ordertip_dialog_wrapper .btn").removeClass("via")):0==o&&(a(".ordertip_dialog_wrapper .recharge_mode").addClass("hid"),a(".ordertip_dialog_wrapper .btn").addClass("via"))}},getQueryVariable:function(e){for(var i=window.location.search.substring(1),a=i.split("&"),t=0;t<a.length;t++){var o=a[t].split("=");if(o[0]==e)return o[1]}return""},validateCode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.data;cart.qrPay({product_id:e.product_id,goods_id:e.goods_id,flag:e.flag,bind_vip:e.bind_vip,sale_source:h,report_ext:C,is_use_balance:Number(u),coupon_key:e.coupon_key,success_function:o,error_function:n,timeout_function:s,payment_function:d,get_pay_success_callback:c,use_cache:!0})},createMask:function(){var e=i.createElement("div");e.id="user-ordertip-box",i.body.appendChild(e)},checkPopup:function(e){I.sendAjax(function(e){e.code&&200==e.code?e.data&&I.initDialog(e.data):console.warn("该商品暂无数据")},e)},checkPopup_1:function(e){I.sendAjax(function(e){e.code&&200==e.code?e.data&&I.initDialog_1(e.data):console.warn("该商品暂无数据")},e)},sendAjax:function(e,i){a.ajax({url:"https://mall.csdn.net/mp/order/internal/getVipInfo",type:"GET",dataType:"json",contentType:"application/json",async:!1,xhrFields:{withCredentials:!0},data:i||{},success:function(i){v=i,e(i)},error:function(i){if(i&&i.responseText){var a=JSON.parse(i.responseText)||{};a.message=a.message||"接口异常"}else e({})}})},getGoodId:function(e){a.ajax({url:"https://mall.csdn.net/mp/order/internal/vipList",type:"GET",dataType:"json",contentType:"application/json",async:!1,xhrFields:{withCredentials:!0},data:e||{},success:function(e){m=e.data.filter(function(e,i,a){return 6==e.ext.flag}),f=e.data.filter(function(e,i,a){return 28==e.ext.flag}),I.checkPopup(k)},error:function(e){if(e&&e.responseText){var i=JSON.parse(e.responseText)||{};i.message=i.message||"接口异常"}else callback({})}})}};e.userOrderTip.close=function(){a("#user-ordertip-box").remove()},e.userOrderTip.show=function(e){h=e.sale_source||I.getQueryVariable("sale_source"),C=e.report_ext||{},k={goods_id:e.goods_id,product_id:e.product_id,flag:e.flag},e.vipActivityId&&"ecsdnpac"==e.vipActivityId?(y={vipActivityId:e.vipActivityId},I.getGoodId(y),b=e.flag):(b=e.flag,I.getGoodId())}}(window.csdn=window.csdn||{},document,jQuery);